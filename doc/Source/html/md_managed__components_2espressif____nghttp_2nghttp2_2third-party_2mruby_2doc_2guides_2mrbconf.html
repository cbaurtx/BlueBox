<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueBox: mruby configuration macros</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueBox<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">BlueBox Bluetooth sink</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">mruby configuration macros </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md348"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md349"></a>
The configuration file</h1>
<p>You can do the build configuration in the build configuration file. The default configuration file is <span class="tt">build_config/default.rb</span>.</p>
<p>You can specify your own configuration file by the <span class="tt">MRUBY_CONFIG</span> environment variable (you can use <span class="tt">CONFIG</span> for shorthand for <span class="tt">MRUBY_CONFIG</span>). If the path doesn't exist, <span class="tt">build_config/${MRUBY_CONFIG}.rb</span> is used.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md350"></a>
How to use these macros</h1>
<p>Just add the configuration value to the <span class="tt">MRuby::Build#defines</span> attribute. This is the same for <span class="tt">MRuby::CrossBuild</span>.</p>
<div class="fragment"><div class="line"># build_config.rb</div>
<div class="line"> </div>
<div class="line">MRuby::Build.new do |conf|</div>
<div class="line">  ...</div>
<div class="line">  conf.defines &lt;&lt; &#39;MRB_GC_FIXED_ARENA&#39;</div>
<div class="line">  conf.defines &lt;&lt; &#39;MRB_NO_METHOD_CACHE&#39;</div>
<div class="line">  ...</div>
<div class="line">end</div>
</div><!-- fragment --><p><b><em>NOTE</em></b></p>
<ul>
<li>Use common definitions (<span class="tt">conf.defines</span>) instead of per-compiler definitions (e.g., <span class="tt">conf.cc.defines</span>) unless there is a special reason not to.</li>
<li>It is now deprecated to edit the <span class="tt">include/mruby/mrbconf.h</span> file or give it directly as a compiler flag, as was the case before.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md351"></a>
stdio setting</h1>
<p><span class="tt">MRB_NO_STDIO</span></p>
<ul>
<li>When defined <span class="tt">&lt;stdio.h&gt;</span> functions won't be used.</li>
<li>Some features will be disabled when this is enabled:<ul>
<li><span class="tt"><a class="el" href="structmrb__irep.html">mrb_irep</a></span> load/dump from/to file.</li>
<li>Compiling mruby script from a file.</li>
<li>Printing features in <b>src/print.c</b>.</li>
</ul>
</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md352"></a>
Debug macros</h1>
<p><span class="tt">MRB_USE_DEBUG_HOOK</span></p>
<ul>
<li>When defined code fetch hook and debug OP hook will be enabled.</li>
<li>When using any of the hook set function pointer <span class="tt">code_fetch_hook</span> and/or <span class="tt">debug_op_hook</span> of <span class="tt"><a class="el" href="structmrb__state.html">mrb_state</a></span>.</li>
<li>Fetch hook will be called before any OP.</li>
<li>Debug OP hook will be called when dispatching <span class="tt">OP_DEBUG</span>.</li>
</ul>
<p><span class="tt">MRB_DEBUG</span></p>
<ul>
<li>When defined <span class="tt">mrb_assert*</span> macro will be defined with macros from <span class="tt">&lt;assert.h&gt;</span>.</li>
<li>Could be enabled via <span class="tt">enable_debug</span> method of <span class="tt">MRuby::Build</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md353"></a>
Stack configuration</h1>
<p><span class="tt">MRB_STACK_EXTEND_DOUBLING</span></p>
<ul>
<li>If defined doubles the stack size when extending it.</li>
<li>Otherwise extends stack with <span class="tt">MRB_STACK_GROWTH</span>.</li>
</ul>
<p><span class="tt">MRB_STACK_GROWTH</span></p>
<ul>
<li>Default value is <span class="tt">128</span>.</li>
<li>Used in stack extending.</li>
<li>Ignored when <span class="tt">MRB_STACK_EXTEND_DOUBLING</span> is defined.</li>
</ul>
<p><span class="tt">MRB_STACK_MAX</span></p>
<ul>
<li>Default value is <span class="tt">0x40000 - MRB_STACK_GROWTH</span>.</li>
<li>Raises <span class="tt">RuntimeError</span> when stack size exceeds this value.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md354"></a>
Primitive type configuration</h1>
<p><span class="tt">MRB_USE_FLOAT32</span></p>
<ul>
<li>When defined single-precision floating-point type(C type <span class="tt">float</span>) is used as <span class="tt">mrb_float</span>.</li>
<li>Otherwise, double-precision floating-point type(C type <span class="tt">double</span>) is used as <span class="tt">mrb_float</span>.</li>
</ul>
<p><span class="tt">MRB_NO_FLOAT</span></p>
<ul>
<li>When defined removes floating-point numbers from mruby.</li>
<li>It makes mruby easier to handle in "Micro-controller without FPU" and "Kernel Space".</li>
</ul>
<p><span class="tt">MRB_INT32</span></p>
<ul>
<li>When defined, or <span class="tt">MRB_INT64</span> are not defined on 32-bit CPU mode, <span class="tt">mrb_int</span> will be defined as <span class="tt">int32_t</span>.</li>
<li>Conflicts with <span class="tt">MRB_INT64</span>.</li>
</ul>
<p><span class="tt">MRB_INT64</span></p>
<ul>
<li>When defined, or <span class="tt">MRB_INT32</span> are not defined on 64-bit CPU mode, <span class="tt">mrb_int</span> will be defined as <span class="tt">int64_t</span>.</li>
<li>Conflicts with <span class="tt">MRB_INT32</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md355"></a>
Garbage collector configuration</h1>
<p><span class="tt">MRB_GC_STRESS</span></p>
<ul>
<li>When defined full GC is emitted per each <span class="tt"><a class="el" href="structRBasic.html">RBasic</a></span> allocation.</li>
<li>Mainly used in memory manager debugging.</li>
<li>If defined at the same time as <span class="tt">MRB_DEBUG</span>, full GC is emitted also per each heap allocation (<span class="tt">mrb_malloc()</span> or etc.). This configuration slows down mruby execution by a factor of 2 to 3 or even more.</li>
</ul>
<p><span class="tt">MRB_GC_TURN_OFF_GENERATIONAL</span></p>
<ul>
<li>When defined turns generational GC by default.</li>
</ul>
<p><span class="tt">MRB_GC_FIXED_ARENA</span></p>
<ul>
<li>When defined used fixed size GC arena.</li>
<li>Raises <span class="tt">RuntimeError</span> when this is defined and GC arena size exceeds <span class="tt">MRB_GC_ARENA_SIZE</span>.</li>
<li>Useful tracking unnecessary mruby object allocation.</li>
</ul>
<p><span class="tt">MRB_GC_ARENA_SIZE</span></p>
<ul>
<li>Default value is <span class="tt">100</span>.</li>
<li>Ignored when <span class="tt">MRB_GC_FIXED_ARENA</span> isn't defined.</li>
<li>Defines fixed GC arena size.</li>
</ul>
<p><span class="tt">MRB_HEAP_PAGE_SIZE</span></p>
<ul>
<li>Defines value is <span class="tt">1024</span>.</li>
<li>Specifies number of <span class="tt"><a class="el" href="structRBasic.html">RBasic</a></span> per each heap page.</li>
<li>To calculate the number of bytes per heap page, it is "(size of management data per heap page) + (size per object) \* `MRB_HEAP_PAGE_SIZE`". In mruby 3.1.0, the "size of management data per heap page" is 6 words, also "size per object" is 6 words. For a 32-bit CPU, <span class="tt">(6 * 4) + (6 * 4) * MRB_HEAP_PAGE_SIZE</span> gives the bytes of size per heap page. Conversely, for example, to keep the size per heap page to 4 Ki bytes, calculate <span class="tt">(4096 - (6 * 4)) / (6 * 4)</span> to specify <span class="tt">MRB_HEAP_PAGE_SIZE=169</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md356"></a>
Memory pool configuration</h1>
<p><span class="tt">POOL_ALIGNMENT</span></p>
<ul>
<li>Default value is <span class="tt">4</span>.</li>
<li>If you're allocating data types that requires alignment more than default value define the largest value of required alignment.</li>
</ul>
<p><span class="tt">POOL_PAGE_SIZE</span></p>
<ul>
<li>Default value is <span class="tt">16000</span>.</li>
<li>Specifies page size of pool page.</li>
<li>Smaller the value is increases memory overhead.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md357"></a>
State atexit configuration</h1>
<p><span class="tt">MRB_FIXED_STATE_ATEXIT_STACK</span></p>
<ul>
<li>If defined enables fixed size <span class="tt"><a class="el" href="structmrb__state.html">mrb_state</a></span> atexit stack.</li>
<li>Raises <span class="tt">RuntimeError</span> when <span class="tt">mrb_state_atexit</span> call count to same <span class="tt"><a class="el" href="structmrb__state.html">mrb_state</a></span> exceeds <span class="tt">MRB_FIXED_STATE_ATEXIT_STACK_SIZE</span>'s value.</li>
</ul>
<p><span class="tt">MRB_FIXED_STATE_ATEXIT_STACK_SIZE</span></p>
<ul>
<li>Default value is <span class="tt">5</span>.</li>
<li>If <span class="tt">MRB_FIXED_STATE_ATEXIT_STACK</span> isn't defined this macro is ignored.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md358"></a>
<span class="tt">mrb_value</span> configuration</h1>
<p><span class="tt">MRB_ENDIAN_BIG</span></p>
<ul>
<li>If defined compiles mruby for big endian machines.</li>
<li>Used in <span class="tt">MRB_NAN_BOXING</span>.</li>
<li>Some mrbgem use this mrbconf.</li>
</ul>
<p><span class="tt">MRB_NAN_BOXING</span></p>
<ul>
<li>If defined represent <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span> in boxed <span class="tt">double</span>.</li>
<li>Conflicts with <span class="tt">MRB_USE_FLOAT32</span> and <span class="tt">MRB_NO_FLOAT</span>.</li>
</ul>
<p><span class="tt">MRB_WORD_BOXING</span></p>
<ul>
<li>If defined represent <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span> as a word.</li>
<li>If defined <span class="tt">Float</span> will be a mruby object with <span class="tt"><a class="el" href="structRBasic.html">RBasic</a></span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md359"></a>
Reduce heap memory configuration</h1>
<p><span class="tt">MRB_USE_ETEXT_RO_DATA_P</span></p>
<ul>
<li>Use <span class="tt">etext</span> and <span class="tt">edata</span> section addresses defined by the linker to detect read-only data.</li>
<li>Those addresses are widely available, but not portable, nor standardized.</li>
<li>This macro is defined by default on User-mode Linux.</li>
</ul>
<p><span class="tt">MRB_NO_DEFAULT_RO_DATA_P</span></p>
<ul>
<li>Define this macro when the default <span class="tt">mrb_ro_data_p()</span> does not work for any reason.</li>
</ul>
<p><span class="tt">MRB_USE_CUSTOM_RO_DATA_P</span></p>
<ul>
<li>Please try if <span class="tt">MRB_USE_LINK_TIME_RO_DATA_P</span> is not available.</li>
<li>The <span class="tt">mrb_ro_data_p()</span> function is implemented by the user in an arbitrary file.</li>
<li>The prototype declaration is <span class="tt"><a class="el" href="classmrb__bool.html">mrb_bool</a> mrb_ro_data_p(const char *ptr)</span>.</li>
<li>Return <span class="tt">TRUE</span> if <span class="tt">ptr</span> is in the read-only section, otherwise return <span class="tt">FALSE</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md360"></a>
Other configuration</h1>
<p><span class="tt">MRB_MALLOC_TRIM</span></p>
<ul>
<li>call malloc_trim(0) for each mrb_full_gc() call</li>
</ul>
<p><span class="tt">MRB_UTF8_STRING</span></p>
<ul>
<li>Adds UTF-8 encoding support to character-oriented String instance methods.</li>
<li>If it isn't defined, they only support the US-ASCII encoding.</li>
</ul>
<p><span class="tt">MRB_STR_LENGTH_MAX</span></p>
<ul>
<li>The maximum length of strings (default 1MB)</li>
<li>set this value to zero to skip the check</li>
</ul>
<p><span class="tt">MRB_ARY_LENGTH_MAX</span></p>
<ul>
<li>The maximum length of strings (default 1MB)</li>
<li>set this value to zero to skip the check</li>
</ul>
<p><span class="tt">MRB_FUNCALL_ARGC_MAX</span></p>
<ul>
<li>Default value is <span class="tt">16</span>.</li>
<li>Specifies 4th argument(<span class="tt">argc</span>) max value of <span class="tt"><a class="el" href="mruby_8h.html#ab0c4a601cb4dc2ddf3470d604dbc9113">mrb_funcall</a></span>.</li>
<li>Raises <span class="tt">ArgumentError</span> when the <span class="tt">argc</span> argument is bigger then this value <span class="tt"><a class="el" href="mruby_8h.html#ab0c4a601cb4dc2ddf3470d604dbc9113">mrb_funcall</a></span>.</li>
</ul>
<p><span class="tt">KHASH_DEFAULT_SIZE</span></p>
<ul>
<li>Default value is <span class="tt">32</span>.</li>
<li>Specifies default size of khash table bucket.</li>
<li>Used in <span class="tt">kh_init_ ## name</span> function.</li>
</ul>
<p><span class="tt">MRB_NO_METHOD_CACHE</span></p>
<ul>
<li>Disable method cache to save memory.</li>
</ul>
<p><span class="tt">MRB_METHOD_CACHE_SIZE</span></p>
<ul>
<li>Default value is <span class="tt">256</span>.</li>
<li>Ignored if <span class="tt">MRB_NO_METHOD_CACHE</span> is defined.</li>
<li>Need to be the power of 2.</li>
</ul>
<p><span class="tt">MRB_USE_METHOD_T_STRUCT</span></p>
<ul>
<li>Use C struct to represent <span class="tt">mrb_method_t</span></li>
<li>No <span class="tt">MRB_USE_METHOD_T_STRUCT</span> requires highest 2 bits of function pointers to be zero</li>
<li>Define this macro on machines that use higher bits of pointers</li>
</ul>
<p><span class="tt">MRB_USE_ALL_SYMBOLS</span></p>
<ul>
<li>Make it available <span class="tt">Symbol.all_symbols</span> in <span class="tt">mrbgems/mruby-symbol-ext</span></li>
<li>Increase heap memory usage.</li>
</ul>
<p><span class="tt">MRB_USE_VM_SWITCH_DISPATCH</span></p>
<ul>
<li>Turn on switch dispatch in VM loop </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
