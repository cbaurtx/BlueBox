<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueBox: managed_components/espressif__nghttp Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueBox<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">BlueBox Bluetooth sink</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>managed_components</b></li><li class="navelem"><a href="dir_9daa05842a3b93b9b84970416d2aacb6.html">espressif__nghttp</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">espressif__nghttp Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Directory dependency graph for espressif__nghttp:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="dir_9daa05842a3b93b9b84970416d2aacb6_dep.svg" width="267" height="203"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-subdirs" class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:nghttp2" id="r_nghttp2"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_f5d6b1fa1b969a5a23fe8a389f280561.html">nghttp2</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<p>This is an implementation of the Hypertext Transfer Protocol version 2 in C.</p>
<p>The framing layer of HTTP/2 is implemented as a reusable C library. On top of that, we have implemented an HTTP/2 client, server and proxy. We have also developed load test and benchmarking tools for HTTP/2.</p>
<p>An HPACK encoder and decoder are available as a public API.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md583"></a>
Development Status</h1>
<p>nghttp2 was originally developed based on <span class="tt">RFC 7540
&lt;<a href="https://tools.ietf.org/html/rfc7540">https://tools.ietf.org/html/rfc7540</a>&gt;</span>_ HTTP/2 and <span class="tt">RFC 7541
&lt;<a href="https://tools.ietf.org/html/rfc7541">https://tools.ietf.org/html/rfc7541</a>&gt;</span>_ HPACK - Header Compression for HTTP/2. Now we are updating our code to implement <span class="tt">RFC 9113
&lt;<a href="https://datatracker.ietf.org/doc/html/rfc9113">https://datatracker.ietf.org/doc/html/rfc9113</a>&gt;</span>_.</p>
<p>The nghttp2 code base was forked from the spdylay (<a href="https://github.com/tatsuhiro-t/spdylay">https://github.com/tatsuhiro-t/spdylay</a>) project.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md584"></a>
Public Test Server</h1>
<p>The following endpoints are available to try out our nghttp2 implementation.</p>
<ul>
<li><p class="startli"><a href="https://nghttp2.org/">https://nghttp2.org/</a> (TLS + ALPN and HTTP/3)</p>
<p class="startli">This endpoint supports <span class="tt">h2</span>, <span class="tt">h2-16</span>, <span class="tt">h2-14</span>, and <span class="tt">http/1.1</span> via ALPN and requires TLSv1.2 for HTTP/2 connection.</p>
<p class="startli">It also supports HTTP/3.</p>
</li>
<li><p class="startli"><a href="http://nghttp2.org/">http://nghttp2.org/</a> (HTTP Upgrade and HTTP/2 Direct)</p>
<p class="startli"><span class="tt">h2c</span> and <span class="tt">http/1.1</span>.</p>
</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md585"></a>
Requirements</h1>
<p>The following package is required to build the libnghttp2 library:</p>
<ul>
<li>pkg-config &gt;= 0.20</li>
</ul>
<p>To build the documentation, you need to install:</p>
<ul>
<li>sphinx (<a href="http://sphinx-doc.org/">http://sphinx-doc.org/</a>)</li>
</ul>
<p>If you need libnghttp2 (C library) only, then the above packages are all you need. Use <span class="tt">--enable-lib-only</span> to ensure that only libnghttp2 is built. This avoids potential build error related to building bundled applications.</p>
<p>To build and run the application programs (<span class="tt">nghttp</span>, <span class="tt">nghttpd</span>, <span class="tt">nghttpx</span> and <span class="tt">h2load</span>) in the <span class="tt">src</span> directory, the following packages are required:</p>
<ul>
<li>OpenSSL &gt;= 1.1.1; or wolfSSL &gt;= 5.7.0; or LibreSSL &gt;= 3.8.1; or aws-lc &gt;= 1.19.0; or BoringSSL</li>
<li>libev &gt;= 4.11</li>
<li>zlib &gt;= 1.2.3</li>
<li>libc-ares &gt;= 1.7.5</li>
</ul>
<p>To enable <span class="tt">-a</span> option (getting linked assets from the downloaded resource) in <span class="tt">nghttp</span>, the following package is required:</p>
<ul>
<li>libxml2 &gt;= 2.6.26</li>
</ul>
<p>To enable systemd support in nghttpx, the following package is required:</p>
<ul>
<li>libsystemd-dev &gt;= 209</li>
</ul>
<p>The HPACK tools require the following package:</p>
<ul>
<li>jansson &gt;= 2.5</li>
</ul>
<p>To build sources under the examples directory, libevent is required:</p>
<ul>
<li>libevent-openssl &gt;= 2.0.8</li>
</ul>
<p>To mitigate heap fragmentation in long running server programs (<span class="tt">nghttpd</span> and <span class="tt">nghttpx</span>), jemalloc is recommended:</p>
<ul>
<li><p class="startli">jemalloc</p>
<p class="startli">.. note::</p>
<p class="startli">Alpine Linux currently does not support malloc replacement due to musl limitations. See details in issue <span class="tt">#762 &lt;<a href="https://github.com/nghttp2/nghttp2/issues/762">https://github.com/nghttp2/nghttp2/issues/762</a>&gt;</span>_.</p>
</li>
</ul>
<p>For BoringSSL or aws-lc build, to enable :rfc:<span class="tt">8879</span> TLS Certificate Compression in applications, the following library is required:</p>
<ul>
<li>libbrotli-dev &gt;= 1.0.9</li>
</ul>
<p>To enable mruby support for nghttpx, <span class="tt">mruby
&lt;<a href="https://github.com/mruby/mruby">https://github.com/mruby/mruby</a>&gt;</span>_ is required. We need to build mruby with C++ ABI explicitly turned on, and probably need other mrgems, mruby is managed by git submodule under third-party/mruby directory. Currently, mruby support for nghttpx is disabled by default. To enable mruby support, use <span class="tt">--with-mruby</span> configure option. Note that at the time of this writing, libmruby-dev and mruby packages in Debian/Ubuntu are not usable for nghttp2, since they do not enable C++ ABI. To build mruby, the following packages are required:</p>
<ul>
<li>ruby</li>
<li>bison</li>
</ul>
<p>nghttpx supports <span class="tt">neverbleed &lt;<a href="https://github.com/h2o/neverbleed">https://github.com/h2o/neverbleed</a>&gt;</span>_, privilege separation engine for OpenSSL. In short, it minimizes the risk of private key leakage when serious bug like Heartbleed is exploited. The neverbleed is disabled by default. To enable it, use <span class="tt">--with-neverbleed</span> configure option.</p>
<p>To enable the experimental HTTP/3 support for h2load and nghttpx, the following libraries are required:</p>
<ul>
<li><span class="tt">OpenSSL with QUIC support
  &lt;<a href="https://github.com/quictls/openssl/tree/OpenSSL_1_1_1w+quic">https://github.com/quictls/openssl/tree/OpenSSL_1_1_1w+quic</a>&gt;</span>_; or wolfSSL; or LibreSSL (does not support 0RTT); or aws-lc; or <span class="tt">BoringSSL &lt;<a href="https://boringssl.googlesource.com/boringssl/">https://boringssl.googlesource.com/boringssl/</a>&gt;</span>_ (commit 294ab9730c570213b496cfc2fc14b3c0bfcd4bcc)</li>
<li><span class="tt">ngtcp2 &lt;<a href="https://github.com/ngtcp2/ngtcp2">https://github.com/ngtcp2/ngtcp2</a>&gt;</span>_ &gt;= 1.4.0</li>
<li><span class="tt">nghttp3 &lt;<a href="https://github.com/ngtcp2/nghttp3">https://github.com/ngtcp2/nghttp3</a>&gt;</span>_ &gt;= 1.1.0</li>
</ul>
<p>Use <span class="tt">--enable-http3</span> configure option to enable HTTP/3 feature for h2load and nghttpx.</p>
<p>In order to build optional eBPF program to direct an incoming QUIC UDP datagram to a correct socket for nghttpx, the following libraries are required:</p>
<ul>
<li>libbpf-dev &gt;= 0.7.0</li>
</ul>
<p>Use <span class="tt">--with-libbpf</span> configure option to build eBPF program. libelf-dev is needed to build libbpf.</p>
<p>For Ubuntu 20.04, you can build libbpf from <span class="tt">the source code
&lt;<a href="https://github.com/libbpf/libbpf/releases">https://github.com/libbpf/libbpf/releases</a>&gt;</span>_. nghttpx requires eBPF program for reloading its configuration and hot swapping its executable.</p>
<p>Compiling libnghttp2 C source code requires a C99 compiler. gcc 4.8 is known to be adequate. In order to compile the C++ source code, C++20 compliant compiler is required. At least g++ &gt;= 12 and clang++ &gt;= 15 are known to work.</p>
<p>.. note::</p>
<p>To enable mruby support in nghttpx, and use <span class="tt">--with-mruby</span> configure option.</p>
<p>.. note::</p>
<p>Mac OS X users may need the <span class="tt">--disable-threads</span> configure option to disable multi-threading in nghttpd, nghttpx and h2load to prevent them from crashing. A patch is welcome to make multi threading work on Mac OS X platform.</p>
<p>.. note::</p>
<p>To compile the associated applications (nghttp, nghttpd, nghttpx and h2load), you must use the <span class="tt">--enable-app</span> configure option and ensure that the specified requirements above are met. Normally, configure script checks required dependencies to build these applications, and enable <span class="tt">--enable-app</span> automatically, so you don't have to use it explicitly. But if you found that applications were not built, then using <span class="tt">--enable-app</span> may find that cause, such as the missing dependency.</p>
<p>.. note::</p>
<p>In order to detect third party libraries, pkg-config is used (however we don't use pkg-config for some libraries (e.g., libev)). By default, pkg-config searches <span class="tt">*.pc</span> file in the standard locations (e.g., /usr/lib/pkgconfig). If it is necessary to use <span class="tt">*.pc</span> file in the custom location, specify paths to <span class="tt">PKG_CONFIG_PATH</span> environment variable, and pass it to configure script, like so:</p>
<p>.. code-block:: text </p><pre class="fragment">$ ./configure PKG_CONFIG_PATH=/path/to/pkgconfig
</pre><p>For pkg-config managed libraries, <span class="tt">*_CFLAG</span> and <span class="tt">*_LIBS</span> environment variables are defined (e.g., <span class="tt">OPENSSL_CFLAGS</span>, <span class="tt">OPENSSL_LIBS</span>). Specifying non-empty string to these variables completely overrides pkg-config. In other words, if they are specified, pkg-config is not used for detection, and user is responsible to specify the correct values to these variables. For complete list of these variables, run <span class="tt">./configure -h</span>.</p>
<p>If you are using Ubuntu 22.04 LTS, run the following to install the required packages:</p>
<p>.. code-block:: text </p><pre class="fragment">sudo apt-get install g++ clang make binutils autoconf automake \
  autotools-dev libtool pkg-config \
  zlib1g-dev libssl-dev libxml2-dev libev-dev \
  libevent-dev libjansson-dev \
  libc-ares-dev libjemalloc-dev libsystemd-dev \
  ruby-dev bison libelf-dev
</pre><h1 class="doxsection"><a class="anchor" id="autotoc_md586"></a>
Building nghttp2 from release tar archive</h1>
<p>The nghttp2 project regularly releases tar archives which includes nghttp2 source code, and generated build files. They can be downloaded from <span class="tt">Releases
&lt;<a href="https://github.com/nghttp2/nghttp2/releases">https://github.com/nghttp2/nghttp2/releases</a>&gt;</span>_ page.</p>
<p>Building nghttp2 from git requires autotools development packages. Building from tar archives does not require them, and thus it is much easier. The usual build step is as follows:</p>
<p>.. code-block:: text </p><pre class="fragment">$ tar xf nghttp2-X.Y.Z.tar.bz2
$ cd nghttp2-X.Y.Z
$ ./configure
$ make
</pre><h1 class="doxsection"><a class="anchor" id="autotoc_md587"></a>
Building from git</h1>
<p>Building from git is easy, but please be sure that at least autoconf 2.68 is used:</p>
<p>.. code-block:: text </p><pre class="fragment">$ git submodule update --init
$ autoreconf -i
$ automake
$ autoconf
$ ./configure
$ make
</pre><h1 class="doxsection"><a class="anchor" id="autotoc_md588"></a>
Notes for building on Windows (MSVC)</h1>
<p>The easiest way to build native Windows nghttp2 dll is use <span class="tt">cmake
&lt;<a href="https://cmake.org/">https://cmake.org/</a>&gt;</span>_. The free version of <span class="tt">Visual C++ Build Tools
&lt;<a href="http://landinghub.visualstudio.com/visual-cpp-build-tools">http://landinghub.visualstudio.com/visual-cpp-build-tools</a>&gt;</span>_ works fine.</p>
<ol type="1">
<li>Install cmake for windows</li>
<li>Open "Visual C++ ... Native Build Tool Command Prompt", and inside nghttp2 directly, run <span class="tt">cmake</span>.</li>
<li>Then run <span class="tt">cmake --build</span> to build library.</li>
<li>nghttp2.dll, nghttp2.lib, nghttp2.exp are placed under lib directory.</li>
</ol>
<p>Note that the above steps most likely produce nghttp2 library only. No bundled applications are compiled.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md589"></a>
Notes for building on Windows (Mingw/Cygwin)</h1>
<p>Under Mingw environment, you can only compile the library, it's <span class="tt">libnghttp2-X.dll</span> and <span class="tt">libnghttp2.a</span>.</p>
<p>If you want to compile the applications(<span class="tt">h2load</span>, <span class="tt">nghttp</span>, <span class="tt">nghttpx</span>, <span class="tt">nghttpd</span>), you need to use the Cygwin environment.</p>
<p>Under Cygwin environment, to compile the applications you need to compile and install the libev first.</p>
<p>Secondly, you need to undefine the macro <span class="tt">__STRICT_ANSI__</span>, if you not, the functions <span class="tt">fdopen</span>, <span class="tt">fileno</span> and <span class="tt">strptime</span> will not available.</p>
<p>the sample command like this:</p>
<p>.. code-block:: text </p><pre class="fragment">$ export CFLAGS="-U__STRICT_ANSI__ -I$libev_PREFIX/include -L$libev_PREFIX/lib"
$ export CXXFLAGS=$CFLAGS
$ ./configure
$ make
</pre><p>If you want to compile the applications under <span class="tt">examples/</span>, you need to remove or rename the <span class="tt">event.h</span> from libev's installation, because it conflicts with libevent's installation.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md590"></a>
Notes for installation on Linux systems</h1>
<p>After installing nghttp2 tool suite with <span class="tt">make install</span> one might experience a similar error:</p>
<p>.. code-block:: text </p><pre class="fragment">nghttpx: error while loading shared libraries: libnghttp2.so.14: cannot open shared object file: No such file or directory
</pre><p>This means that the tool is unable to locate the <span class="tt">libnghttp2.so</span> shared library.</p>
<p>To update the shared library cache run <span class="tt">sudo ldconfig</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md591"></a>
Building the documentation</h1>
<p>.. note::</p>
<p>Documentation is still incomplete.</p>
<p>To build the documentation, run:</p>
<p>.. code-block:: text </p><pre class="fragment">$ make html
</pre><p>The documents will be generated under <span class="tt">doc/manual/html/</span>.</p>
<p>The generated documents will not be installed with <span class="tt">make install</span>.</p>
<p>The online documentation is available at <a href="https://nghttp2.org/documentation/">https://nghttp2.org/documentation/</a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md592"></a>
Build HTTP/3 enabled h2load and nghttpx</h1>
<p>To build h2load and nghttpx with HTTP/3 feature enabled, run the configure script with <span class="tt">--enable-http3</span>.</p>
<p>For nghttpx to reload configurations and swapping its executable while gracefully terminating old worker processes, eBPF is required. Run the configure script with <span class="tt">--enable-http3 --with-libbpf</span> to build eBPF program. The QUIC keying material must be set with <span class="tt">--frontend-quic-secret-file</span> in order to keep the existing connections alive during reload.</p>
<p>The detailed steps to build HTTP/3 enabled h2load and nghttpx follow.</p>
<p>Build aws-lc:</p>
<p>.. code-block:: text</p>
<p>$ git clone &ndash;depth 1 -b v1.46.1 <a href="https://github.com/aws/aws-lc">https://github.com/aws/aws-lc</a> $ cd aws-lc $ cmake -B build -DDISABLE_GO=ON &ndash;install-prefix=$PWD/opt $ make -j$(nproc) -C build $ cmake &ndash;install build $ cd ..</p>
<p>Build nghttp3:</p>
<p>.. code-block:: text</p>
<p>$ git clone &ndash;depth 1 -b v1.8.0 <a href="https://github.com/ngtcp2/nghttp3">https://github.com/ngtcp2/nghttp3</a> $ cd nghttp3 $ git submodule update &ndash;init &ndash;depth 1 $ autoreconf -i $ ./configure &ndash;prefix=$PWD/build &ndash;enable-lib-only $ make -j$(nproc) $ make install $ cd ..</p>
<p>Build ngtcp2:</p>
<p>.. code-block:: text</p>
<p>$ git clone &ndash;depth 1 -b v1.11.0 <a href="https://github.com/ngtcp2/ngtcp2">https://github.com/ngtcp2/ngtcp2</a> $ cd ngtcp2 $ git submodule update &ndash;init &ndash;depth 1 $ autoreconf -i $ ./configure &ndash;prefix=$PWD/build &ndash;enable-lib-only &ndash;with-boringssl \ BORINGSSL_CFLAGS="-I$PWD/../aws-lc/opt/include" \ BORINGSSL_LIBS="-L$PWD/../aws-lc/opt/lib -lssl -lcrypto" $ make -j$(nproc) $ make install $ cd ..</p>
<p>If your Linux distribution does not have libbpf-dev &gt;= 0.7.0, build from source:</p>
<p>.. code-block:: text</p>
<p>$ git clone &ndash;depth 1 -b v1.5.0 <a href="https://github.com/libbpf/libbpf">https://github.com/libbpf/libbpf</a> $ cd libbpf $ PREFIX=$PWD/build make -C src install $ cd ..</p>
<p>Build nghttp2:</p>
<p>.. code-block:: text</p>
<p>$ git clone <a href="https://github.com/nghttp2/nghttp2">https://github.com/nghttp2/nghttp2</a> $ cd nghttp2 $ git submodule update &ndash;init $ autoreconf -i $ ./configure &ndash;with-mruby &ndash;enable-http3 &ndash;with-libbpf \ CC=clang-15 CXX=clang++-15 \ PKG_CONFIG_PATH="$PWD/../aws-lc/opt/lib/pkgconfig:$PWD/../nghttp3/build/lib/pkgconfig:$PWD/../ngtcp2/build/lib/pkgconfig:$PWD/../libbpf/build/lib64/pkgconfig" \ LDFLAGS="$LDFLAGS -Wl,-rpath,$PWD/../aws-lc/opt/lib -Wl,-rpath,$PWD/../libbpf/build/lib64" $ make -j$(nproc)</p>
<p>The eBPF program <span class="tt">reuseport_kern.o</span> should be found under bpf directory. Pass <span class="tt">--quic-bpf-program-file=bpf/reuseport_kern.o</span> option to nghttpx to load it. See also <span class="tt">HTTP/3 section in nghttpx -
HTTP/2 proxy - HOW-TO
&lt;<a href="https://nghttp2.org/documentation/nghttpx-howto.html">https://nghttp2.org/documentation/nghttpx-howto.html</a>#http-3&gt;</span>_.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md593"></a>
Unit tests</h1>
<p>Unit tests are done by simply running <span class="tt">make check</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md594"></a>
Integration tests</h1>
<p>We have the integration tests for the nghttpx proxy server. The tests are written in the <span class="tt">Go programming language &lt;<a href="http://golang.org/">http://golang.org/</a>&gt;</span>_ and uses its testing framework. We depend on the following libraries:</p>
<ul>
<li>golang.org/x/net/http2</li>
<li>golang.org/x/net/websocket</li>
<li><a href="https://github.com/tatsuhiro-t/go-nghttp2">https://github.com/tatsuhiro-t/go-nghttp2</a></li>
</ul>
<p>Go modules will download these dependencies automatically.</p>
<p>To run the tests, run the following command under <span class="tt">integration-tests</span> directory:</p>
<p>.. code-block:: text </p><pre class="fragment">$ make it
</pre><p>Inside the tests, we use port 3009 to run the test subject server.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md595"></a>
Migration from v0.7.15 or earlier</h1>
<p>nghttp2 v1.0.0 introduced several backward incompatible changes. In this section, we describe these changes and how to migrate to v1.0.0.</p>
<p>ALPN protocol ID is now <span class="tt">h2</span> and <span class="tt">h2c</span> ++++++++++++++++++++++++++++++++++++++++++</p>
<p>Previously we announced <span class="tt">h2-14</span> and <span class="tt">h2c-14</span>. v1.0.0 implements final protocol version, and we changed ALPN ID to <span class="tt">h2</span> and <span class="tt">h2c</span>. The macros <span class="tt">NGHTTP2_PROTO_VERSION_ID</span>, <span class="tt">NGHTTP2_PROTO_VERSION_ID_LEN</span>, <span class="tt">NGHTTP2_CLEARTEXT_PROTO_VERSION_ID</span>, and <span class="tt">NGHTTP2_CLEARTEXT_PROTO_VERSION_ID_LEN</span> have been updated to reflect this change.</p>
<p>Basically, existing applications do not have to do anything, just recompiling is enough for this change.</p>
<p>Use word "client magic" where we use "client connection preface" ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p>
<p>We use "client connection preface" to mean first 24 bytes of client connection preface. This is technically not correct, since client connection preface is composed of 24 bytes client magic byte string followed by SETTINGS frame. For clarification, we call "client magic" for this 24 bytes byte string and updated API.</p>
<ul>
<li><span class="tt">NGHTTP2_CLIENT_CONNECTION_PREFACE</span> was replaced with <span class="tt">NGHTTP2_CLIENT_MAGIC</span>.</li>
<li><span class="tt">NGHTTP2_CLIENT_CONNECTION_PREFACE_LEN</span> was replaced with <span class="tt">NGHTTP2_CLIENT_MAGIC_LEN</span>.</li>
<li><span class="tt">NGHTTP2_BAD_PREFACE</span> was renamed as <span class="tt">NGHTTP2_BAD_CLIENT_MAGIC</span></li>
</ul>
<p>The already deprecated <span class="tt">NGHTTP2_CLIENT_CONNECTION_HEADER</span> and <span class="tt">NGHTTP2_CLIENT_CONNECTION_HEADER_LEN</span> were removed.</p>
<p>If application uses these macros, just replace old ones with new ones. Since v1.0.0, client magic is sent by library (see next subsection), so client application may just remove these macro use.</p>
<p>Client magic is sent by library +++++++++++++++++++++++++++++++</p>
<p>Previously nghttp2 library did not send client magic, which is first 24 bytes byte string of client connection preface, and client applications have to send it by themselves. Since v1.0.0, client magic is sent by library via first call of <span class="tt">nghttp2_session_send()</span> or <span class="tt">nghttp2_session_mem_send2()</span>.</p>
<p>The client applications which send client magic must remove the relevant code.</p>
<p>Remove HTTP Alternative Services (Alt-Svc) related code +++++++++++++++++++++++++++++++++++++++++++++++++++++++</p>
<p>Alt-Svc specification is not finalized yet. To make our API stable, we have decided to remove all Alt-Svc related API from nghttp2.</p>
<ul>
<li><span class="tt">NGHTTP2_EXT_ALTSVC</span> was removed.</li>
<li><span class="tt"><a class="el" href="structnghttp2__ext__altsvc.html">nghttp2_ext_altsvc</a></span> was removed.</li>
</ul>
<p>We have already removed the functionality of Alt-Svc in v0.7 series and they have been essentially noop. The application using these macro and struct, remove those lines.</p>
<p>Use nghttp2_error in nghttp2_on_invalid_frame_recv_callback +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p>
<p>Previously <span class="tt">nghttp2_on_invalid_frame_recv_cb_called</span> took the <span class="tt">error_code</span>, defined in <span class="tt">nghttp2_error_code</span>, as parameter. But they are not detailed enough to debug. Therefore, we decided to use more detailed <span class="tt">nghttp2_error</span> values instead.</p>
<p>The application using this callback should update the callback signature. If it treats <span class="tt">error_code</span> as HTTP/2 error code, update the code so that it is treated as <span class="tt">nghttp2_error</span>.</p>
<p>Receive client magic by default +++++++++++++++++++++++++++++++</p>
<p>Previously nghttp2 did not process client magic (24 bytes byte string). To make it deal with it, we had to use <span class="tt">nghttp2_option_set_recv_client_preface()</span>. Since v1.0.0, nghttp2 processes client magic by default and <span class="tt">nghttp2_option_set_recv_client_preface()</span> was removed.</p>
<p>Some application may want to disable this behaviour, so we added <span class="tt">nghttp2_option_set_no_recv_client_magic()</span> to achieve this.</p>
<p>The application using <span class="tt">nghttp2_option_set_recv_client_preface()</span> with nonzero value, just remove it.</p>
<p>The application using <span class="tt">nghttp2_option_set_recv_client_preface()</span> with zero value or not using it must use <span class="tt">nghttp2_option_set_no_recv_client_magic()</span> with nonzero value.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md596"></a>
Client, Server and Proxy programs</h1>
<p>The <span class="tt">src</span> directory contains the HTTP/2 client, server and proxy programs.</p>
<p>nghttp - client +++++++++++++++</p>
<p><span class="tt">nghttp</span> is a HTTP/2 client. It can connect to the HTTP/2 server with prior knowledge, HTTP Upgrade and ALPN TLS extension.</p>
<p>It has verbose output mode for framing information. Here is sample output from <span class="tt">nghttp</span> client:</p>
<p>.. code-block:: text </p><pre class="fragment">$ nghttp -nv https://nghttp2.org
[  0.190] Connected
The negotiated protocol: h2
[  0.212] recv SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;
      (niv=2)
      [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]
      [SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]
[  0.212] send SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;
      (niv=2)
      [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]
      [SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]
[  0.212] send SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;
      ; ACK
      (niv=0)
[  0.212] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=3&gt;
      (dep_stream_id=0, weight=201, exclusive=0)
[  0.212] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=5&gt;
      (dep_stream_id=0, weight=101, exclusive=0)
[  0.212] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=7&gt;
      (dep_stream_id=0, weight=1, exclusive=0)
[  0.212] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=9&gt;
      (dep_stream_id=7, weight=1, exclusive=0)
[  0.212] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=11&gt;
      (dep_stream_id=3, weight=1, exclusive=0)
[  0.212] send HEADERS frame &lt;length=39, flags=0x25, stream_id=13&gt;
      ; END_STREAM | END_HEADERS | PRIORITY
      (padlen=0, dep_stream_id=11, weight=16, exclusive=0)
      ; Open new stream
      :method: GET
      :path: /
      :scheme: https
      :authority: nghttp2.org
      accept: */*
      accept-encoding: gzip, deflate
      user-agent: nghttp2/1.0.1-DEV
[  0.221] recv SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;
      ; ACK
      (niv=0)
[  0.221] recv (stream_id=13) :method: GET
[  0.221] recv (stream_id=13) :scheme: https
[  0.221] recv (stream_id=13) :path: /stylesheets/screen.css
[  0.221] recv (stream_id=13) :authority: nghttp2.org
[  0.221] recv (stream_id=13) accept-encoding: gzip, deflate
[  0.222] recv (stream_id=13) user-agent: nghttp2/1.0.1-DEV
[  0.222] recv PUSH_PROMISE frame &lt;length=50, flags=0x04, stream_id=13&gt;
      ; END_HEADERS
      (padlen=0, promised_stream_id=2)
[  0.222] recv (stream_id=13) :status: 200
[  0.222] recv (stream_id=13) date: Thu, 21 May 2015 16:38:14 GMT
[  0.222] recv (stream_id=13) content-type: text/html
[  0.222] recv (stream_id=13) last-modified: Fri, 15 May 2015 15:38:06 GMT
[  0.222] recv (stream_id=13) etag: W/"555612de-19f6"
[  0.222] recv (stream_id=13) link: &lt;/stylesheets/screen.css&gt;; rel=preload; as=stylesheet
[  0.222] recv (stream_id=13) content-encoding: gzip
[  0.222] recv (stream_id=13) server: nghttpx nghttp2/1.0.1-DEV
[  0.222] recv (stream_id=13) via: 1.1 nghttpx
[  0.222] recv (stream_id=13) strict-transport-security: max-age=31536000
[  0.222] recv HEADERS frame &lt;length=166, flags=0x04, stream_id=13&gt;
      ; END_HEADERS
      (padlen=0)
      ; First response header
[  0.222] recv DATA frame &lt;length=2601, flags=0x01, stream_id=13&gt;
      ; END_STREAM
[  0.222] recv (stream_id=2) :status: 200
[  0.222] recv (stream_id=2) date: Thu, 21 May 2015 16:38:14 GMT
[  0.222] recv (stream_id=2) content-type: text/css
[  0.222] recv (stream_id=2) last-modified: Fri, 15 May 2015 15:38:06 GMT
[  0.222] recv (stream_id=2) etag: W/"555612de-9845"
[  0.222] recv (stream_id=2) content-encoding: gzip
[  0.222] recv (stream_id=2) server: nghttpx nghttp2/1.0.1-DEV
[  0.222] recv (stream_id=2) via: 1.1 nghttpx
[  0.222] recv (stream_id=2) strict-transport-security: max-age=31536000
[  0.222] recv HEADERS frame &lt;length=32, flags=0x04, stream_id=2&gt;
      ; END_HEADERS
      (padlen=0)
      ; First push response header
[  0.228] recv DATA frame &lt;length=8715, flags=0x01, stream_id=2&gt;
      ; END_STREAM
[  0.228] send GOAWAY frame &lt;length=8, flags=0x00, stream_id=0&gt;
      (last_stream_id=2, error_code=NO_ERROR(0x00), opaque_data(0)=[])
</pre><p>The HTTP Upgrade is performed like so:</p>
<p>.. code-block:: text </p><pre class="fragment">$ nghttp -nvu http://nghttp2.org
[  0.011] Connected
[  0.011] HTTP Upgrade request
GET / HTTP/1.1
Host: nghttp2.org
Connection: Upgrade, HTTP2-Settings
Upgrade: h2c
HTTP2-Settings: AAMAAABkAAQAAP__
Accept: */*
User-Agent: nghttp2/1.0.1-DEV


[  0.018] HTTP Upgrade response
HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: h2c


[  0.018] HTTP Upgrade success
[  0.018] recv SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;
      (niv=2)
      [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]
      [SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]
[  0.018] send SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;
      (niv=2)
      [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]
      [SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]
[  0.018] send SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;
      ; ACK
      (niv=0)
[  0.018] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=3&gt;
      (dep_stream_id=0, weight=201, exclusive=0)
[  0.018] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=5&gt;
      (dep_stream_id=0, weight=101, exclusive=0)
[  0.018] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=7&gt;
      (dep_stream_id=0, weight=1, exclusive=0)
[  0.018] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=9&gt;
      (dep_stream_id=7, weight=1, exclusive=0)
[  0.018] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=11&gt;
      (dep_stream_id=3, weight=1, exclusive=0)
[  0.018] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=1&gt;
      (dep_stream_id=11, weight=16, exclusive=0)
[  0.019] recv (stream_id=1) :method: GET
[  0.019] recv (stream_id=1) :scheme: http
[  0.019] recv (stream_id=1) :path: /stylesheets/screen.css
[  0.019] recv (stream_id=1) host: nghttp2.org
[  0.019] recv (stream_id=1) user-agent: nghttp2/1.0.1-DEV
[  0.019] recv PUSH_PROMISE frame &lt;length=49, flags=0x04, stream_id=1&gt;
      ; END_HEADERS
      (padlen=0, promised_stream_id=2)
[  0.019] recv (stream_id=1) :status: 200
[  0.019] recv (stream_id=1) date: Thu, 21 May 2015 16:39:16 GMT
[  0.019] recv (stream_id=1) content-type: text/html
[  0.019] recv (stream_id=1) content-length: 6646
[  0.019] recv (stream_id=1) last-modified: Fri, 15 May 2015 15:38:06 GMT
[  0.019] recv (stream_id=1) etag: "555612de-19f6"
[  0.019] recv (stream_id=1) link: &lt;/stylesheets/screen.css&gt;; rel=preload; as=stylesheet
[  0.019] recv (stream_id=1) accept-ranges: bytes
[  0.019] recv (stream_id=1) server: nghttpx nghttp2/1.0.1-DEV
[  0.019] recv (stream_id=1) via: 1.1 nghttpx
[  0.019] recv HEADERS frame &lt;length=157, flags=0x04, stream_id=1&gt;
      ; END_HEADERS
      (padlen=0)
      ; First response header
[  0.019] recv DATA frame &lt;length=6646, flags=0x01, stream_id=1&gt;
      ; END_STREAM
[  0.019] recv (stream_id=2) :status: 200
[  0.019] recv (stream_id=2) date: Thu, 21 May 2015 16:39:16 GMT
[  0.019] recv (stream_id=2) content-type: text/css
[  0.019] recv (stream_id=2) content-length: 38981
[  0.019] recv (stream_id=2) last-modified: Fri, 15 May 2015 15:38:06 GMT
[  0.019] recv (stream_id=2) etag: "555612de-9845"
[  0.019] recv (stream_id=2) accept-ranges: bytes
[  0.019] recv (stream_id=2) server: nghttpx nghttp2/1.0.1-DEV
[  0.019] recv (stream_id=2) via: 1.1 nghttpx
[  0.019] recv HEADERS frame &lt;length=36, flags=0x04, stream_id=2&gt;
      ; END_HEADERS
      (padlen=0)
      ; First push response header
[  0.026] recv DATA frame &lt;length=16384, flags=0x00, stream_id=2&gt;
[  0.027] recv DATA frame &lt;length=7952, flags=0x00, stream_id=2&gt;
[  0.027] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;
      (window_size_increment=33343)
[  0.032] send WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=2&gt;
      (window_size_increment=33707)
[  0.032] recv DATA frame &lt;length=14645, flags=0x01, stream_id=2&gt;
      ; END_STREAM
[  0.032] recv SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;
      ; ACK
      (niv=0)
[  0.032] send GOAWAY frame &lt;length=8, flags=0x00, stream_id=0&gt;
      (last_stream_id=2, error_code=NO_ERROR(0x00), opaque_data(0)=[])
</pre><p>Using the <span class="tt">-s</span> option, <span class="tt">nghttp</span> prints out some timing information for requests, sorted by completion time:</p>
<p>.. code-block:: text </p><pre class="fragment">$ nghttp -nas https://nghttp2.org/
***** Statistics *****

Request timing:
  responseEnd: the  time  when  last  byte of  response  was  received
               relative to connectEnd
 requestStart: the time  just before  first byte  of request  was sent
               relative  to connectEnd.   If  '*' is  shown, this  was
               pushed by server.
      process: responseEnd - requestStart
         code: HTTP status code
         size: number  of  bytes  received as  response  body  without
               inflation.
          URI: request URI

see http://www.w3.org/TR/resource-timing/#processing-model

sorted by 'complete'

id  responseEnd requestStart  process code size request path
 13    +37.19ms       +280us  36.91ms  200   2K /
  2    +72.65ms *   +36.38ms  36.26ms  200   8K /stylesheets/screen.css
 17    +77.43ms     +38.67ms  38.75ms  200   3K /javascripts/octopress.js
 15    +78.12ms     +38.66ms  39.46ms  200   3K /javascripts/modernizr-2.0.js
</pre><p>Using the <span class="tt">-r</span> option, <span class="tt">nghttp</span> writes more detailed timing data to the given file in HAR format.</p>
<p>nghttpd - server ++++++++++++++++</p>
<p><span class="tt">nghttpd</span> is a multi-threaded static web server.</p>
<p>By default, it uses SSL/TLS connection. Use <span class="tt">--no-tls</span> option to disable it.</p>
<p><span class="tt">nghttpd</span> only accepts HTTP/2 connections via ALPN or direct HTTP/2 connections. No HTTP Upgrade is supported.</p>
<p>The <span class="tt">-p</span> option allows users to configure server push.</p>
<p>Just like <span class="tt">nghttp</span>, it has a verbose output mode for framing information. Here is sample output from <span class="tt">nghttpd</span>:</p>
<p>.. code-block:: text </p><pre class="fragment">$ nghttpd --no-tls -v 8080
IPv4: listen 0.0.0.0:8080
IPv6: listen :::8080
[id=1] [  1.521] send SETTINGS frame &lt;length=6, flags=0x00, stream_id=0&gt;
          (niv=1)
          [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]
[id=1] [  1.521] recv SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;
          (niv=2)
          [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]
          [SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]
[id=1] [  1.521] recv SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;
          ; ACK
          (niv=0)
[id=1] [  1.521] recv PRIORITY frame &lt;length=5, flags=0x00, stream_id=3&gt;
          (dep_stream_id=0, weight=201, exclusive=0)
[id=1] [  1.521] recv PRIORITY frame &lt;length=5, flags=0x00, stream_id=5&gt;
          (dep_stream_id=0, weight=101, exclusive=0)
[id=1] [  1.521] recv PRIORITY frame &lt;length=5, flags=0x00, stream_id=7&gt;
          (dep_stream_id=0, weight=1, exclusive=0)
[id=1] [  1.521] recv PRIORITY frame &lt;length=5, flags=0x00, stream_id=9&gt;
          (dep_stream_id=7, weight=1, exclusive=0)
[id=1] [  1.521] recv PRIORITY frame &lt;length=5, flags=0x00, stream_id=11&gt;
          (dep_stream_id=3, weight=1, exclusive=0)
[id=1] [  1.521] recv (stream_id=13) :method: GET
[id=1] [  1.521] recv (stream_id=13) :path: /
[id=1] [  1.521] recv (stream_id=13) :scheme: http
[id=1] [  1.521] recv (stream_id=13) :authority: localhost:8080
[id=1] [  1.521] recv (stream_id=13) accept: */*
[id=1] [  1.521] recv (stream_id=13) accept-encoding: gzip, deflate
[id=1] [  1.521] recv (stream_id=13) user-agent: nghttp2/1.0.0-DEV
[id=1] [  1.521] recv HEADERS frame &lt;length=41, flags=0x25, stream_id=13&gt;
          ; END_STREAM | END_HEADERS | PRIORITY
          (padlen=0, dep_stream_id=11, weight=16, exclusive=0)
          ; Open new stream
[id=1] [  1.521] send SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;
          ; ACK
          (niv=0)
[id=1] [  1.521] send HEADERS frame &lt;length=86, flags=0x04, stream_id=13&gt;
          ; END_HEADERS
          (padlen=0)
          ; First response header
          :status: 200
          server: nghttpd nghttp2/1.0.0-DEV
          content-length: 10
          cache-control: max-age=3600
          date: Fri, 15 May 2015 14:49:04 GMT
          last-modified: Tue, 30 Sep 2014 12:40:52 GMT
[id=1] [  1.522] send DATA frame &lt;length=10, flags=0x01, stream_id=13&gt;
          ; END_STREAM
[id=1] [  1.522] stream_id=13 closed
[id=1] [  1.522] recv GOAWAY frame &lt;length=8, flags=0x00, stream_id=0&gt;
          (last_stream_id=0, error_code=NO_ERROR(0x00), opaque_data(0)=[])
[id=1] [  1.522] closed
</pre><p>nghttpx - proxy +++++++++++++++</p>
<p><span class="tt">nghttpx</span> is a multi-threaded reverse proxy for HTTP/3, HTTP/2, and HTTP/1.1, and powers <a href="http://nghttp2.org">http://nghttp2.org</a> and supports HTTP/2 server push.</p>
<p>We reworked <span class="tt">nghttpx</span> command-line interface, and as a result, there are several incompatibles from 1.8.0 or earlier. This is necessary to extend its capability, and secure the further feature enhancements in the future release. Please read <span class="tt">Migration from nghttpx v1.8.0 or
earlier
&lt;<a href="https://nghttp2.org/documentation/nghttpx-howto.html">https://nghttp2.org/documentation/nghttpx-howto.html</a>#migration-from-nghttpx-v1-8-0-or-earlier&gt;</span>_ to know how to migrate from earlier releases.</p>
<p><span class="tt">nghttpx</span> implements <span class="tt">important performance-oriented features
&lt;<a href="https://istlsfastyet.com/">https://istlsfastyet.com/</a>#server-performance&gt;</span>_ in TLS, such as session IDs, session tickets (with automatic key rotation), OCSP stapling, dynamic record sizing, ALPN, forward secrecy and HTTP/2. <span class="tt">nghttpx</span> also offers the functionality to share session cache and ticket keys among multiple <span class="tt">nghttpx</span> instances via memcached.</p>
<p><span class="tt">nghttpx</span> has 2 operation modes:</p>
<p>================== ======================== ================ ============= Mode option Frontend Backend Note ================== ======================== ================ ============= default mode HTTP/3, HTTP/2, HTTP/1.1 HTTP/1.1, HTTP/2 Reverse proxy <span class="tt">--http2-proxy</span> HTTP/3, HTTP/2, HTTP/1.1 HTTP/1.1, HTTP/2 Forward proxy ================== ======================== ================ =============</p>
<p>The interesting mode at the moment is the default mode. It works like a reverse proxy and listens for HTTP/3, HTTP/2, and HTTP/1.1 and can be deployed as a SSL/TLS terminator for existing web server.</p>
<p>In all modes, the frontend connections are encrypted by SSL/TLS by default. To disable encryption, use the <span class="tt">no-tls</span> keyword in <span class="tt">--frontend</span> option. If encryption is disabled, incoming HTTP/1.1 connections can be upgraded to HTTP/2 through HTTP Upgrade. On the other hard, backend connections are not encrypted by default. To encrypt backend connections, use <span class="tt">tls</span> keyword in <span class="tt">--backend</span> option.</p>
<p><span class="tt">nghttpx</span> supports a configuration file. See the <span class="tt">--conf</span> option and sample configuration file <span class="tt">nghttpx.conf.sample</span>.</p>
<p>In the default mode, <span class="tt">nghttpx</span> works as reverse proxy to the backend server:</p>
<p>.. code-block:: text </p><pre class="fragment">Client &lt;-- (HTTP/3, HTTP/2, HTTP/1.1) --&gt; nghttpx &lt;-- (HTTP/1.1, HTTP/2) --&gt; Web Server
                                        [reverse proxy]
</pre><p>With the <span class="tt">--http2-proxy</span> option, it works as forward proxy, and it is so called secure HTTP/2 proxy:</p>
<p>.. code-block:: text </p><pre class="fragment">Client &lt;-- (HTTP/3, HTTP/2, HTTP/1.1) --&gt; nghttpx &lt;-- (HTTP/1.1) --&gt; Proxy
                                         [secure proxy]          (e.g., Squid, ATS)
</pre><p>The <span class="tt">Client</span> in the above example needs to be configured to use <span class="tt">nghttpx</span> as secure proxy.</p>
<p>At the time of this writing, both Chrome and Firefox support secure HTTP/2 proxy. One way to configure Chrome to use a secure proxy is to create a proxy.pac script like this:</p>
<p>.. code-block:: javascript </p><pre class="fragment">function FindProxyForURL(url, host) {
    return "HTTPS SERVERADDR:PORT";
}
</pre><p><span class="tt">SERVERADDR</span> and <span class="tt">PORT</span> is the hostname/address and port of the machine nghttpx is running on. Please note that Chrome requires a valid certificate for secure proxy.</p>
<p>Then run Chrome with the following arguments:</p>
<p>.. code-block:: text </p><pre class="fragment">$ google-chrome --proxy-pac-url=file:///path/to/proxy.pac --use-npn
</pre><p>The backend HTTP/2 connections can be tunneled through an HTTP proxy. The proxy is specified using <span class="tt">--backend-http-proxy-uri</span>. The following figure illustrates how nghttpx talks to the outside HTTP/2 proxy through an HTTP proxy:</p>
<p>.. code-block:: text </p><pre class="fragment">Client &lt;-- (HTTP/3, HTTP/2, HTTP/1.1) --&gt; nghttpx &lt;-- (HTTP/2) --

        --===================---&gt; HTTP/2 Proxy
          (HTTP proxy tunnel)     (e.g., nghttpx -s)
</pre><h1 class="doxsection"><a class="anchor" id="autotoc_md597"></a>
Benchmarking tool</h1>
<p>The <span class="tt">h2load</span> program is a benchmarking tool for HTTP/3, HTTP/2, and HTTP/1.1. The UI of <span class="tt">h2load</span> is heavily inspired by <span class="tt">weighttp</span> (<a href="https://github.com/lighttpd/weighttp">https://github.com/lighttpd/weighttp</a>). The typical usage is as follows:</p>
<p>.. code-block:: text </p><pre class="fragment">$ h2load -n100000 -c100 -m100 https://localhost:8443/
starting benchmark...
spawning thread #0: 100 concurrent clients, 100000 total requests
Protocol: TLSv1.2
Cipher: ECDHE-RSA-AES128-GCM-SHA256
Server Temp Key: ECDH P-256 256 bits
progress: 10% done
progress: 20% done
progress: 30% done
progress: 40% done
progress: 50% done
progress: 60% done
progress: 70% done
progress: 80% done
progress: 90% done
progress: 100% done

finished in 771.26ms, 129658 req/s, 4.71MB/s
requests: 100000 total, 100000 started, 100000 done, 100000 succeeded, 0 failed, 0 errored
status codes: 100000 2xx, 0 3xx, 0 4xx, 0 5xx
traffic: 3812300 bytes total, 1009900 bytes headers, 1000000 bytes data
                     min         max         mean         sd        +/- sd
time for request:    25.12ms    124.55ms     51.07ms     15.36ms    84.87%
time for connect:   208.94ms    254.67ms    241.38ms      7.95ms    63.00%
time to 1st byte:   209.11ms    254.80ms    241.51ms      7.94ms    63.00%
</pre><p>The above example issued total 100,000 requests, using 100 concurrent clients (in other words, 100 HTTP/2 sessions), and a maximum of 100 streams per client. With the <span class="tt">-t</span> option, <span class="tt">h2load</span> will use multiple native threads to avoid saturating a single core on client side.</p>
<p>.. warning::</p>
<p><b>Don't use this tool against publicly available servers.</b> That is considered a DOS attack. Please only use it against your private servers.</p>
<p>If the experimental HTTP/3 is enabled, h2load can send requests to HTTP/3 server. To do this, specify <span class="tt">h3</span> to <span class="tt">--alpn-list</span> option like so:</p>
<p>.. code-block:: text </p><pre class="fragment">$ h2load --alpn-list h3 https://127.0.0.1:4433
</pre><p>For nghttp2 v1.58 or earlier, use <span class="tt">--npn-list</span> instead of <span class="tt">--alpn-list</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md598"></a>
HPACK tools</h1>
<p>The <span class="tt">src</span> directory contains the HPACK tools. The <span class="tt">deflatehd</span> program is a command-line header compression tool. The <span class="tt">inflatehd</span> program is a command-line header decompression tool. Both tools read input from stdin and write output to stdout. Errors are written to stderr. They take JSON as input and output. We (mostly) use the same JSON data format described at <a href="https://github.com/http2jp/hpack-test-case">https://github.com/http2jp/hpack-test-case</a>.</p>
<p>deflatehd - header compressor +++++++++++++++++++++++++++++</p>
<p>The <span class="tt">deflatehd</span> program reads JSON data or HTTP/1-style header fields from stdin and outputs compressed header block in JSON.</p>
<p>For the JSON input, the root JSON object must include a <span class="tt">cases</span> key. Its value has to include the sequence of input header set. They share the same compression context and are processed in the order they appear. Each item in the sequence is a JSON object and it must include a <span class="tt">headers</span> key. Its value is an array of JSON objects, which includes exactly one name/value pair.</p>
<p>Example:</p>
<p>.. code-block:: json </p><pre class="fragment">{
  "cases":
  [
    {
      "headers": [
        { ":method": "GET" },
        { ":path": "/" }
      ]
    },
    {
      "headers": [
        { ":method": "POST" },
        { ":path": "/" }
      ]
    }
  ]
}
</pre><p>With the <span class="tt">-t</span> option, the program can accept more familiar HTTP/1 style header field blocks. Each header set is delimited by an empty line:</p>
<p>Example:</p>
<p>.. code-block:: text </p><pre class="fragment">:method: GET
:scheme: https
:path: /

:method: POST
user-agent: nghttp2
</pre><p>The output is in JSON object. It should include a <span class="tt">cases</span> key and its value is an array of JSON objects, which has at least the following keys:</p>
<p>seq The index of header set in the input.</p>
<p>input_length The sum of the length of the name/value pairs in the input.</p>
<p>output_length The length of the compressed header block.</p>
<p>percentage_of_original_size <span class="tt">output_length</span> / <span class="tt">input_length</span> * 100</p>
<p>wire The compressed header block as a hex string.</p>
<p>headers The input header set.</p>
<p>header_table_size The header table size adjusted before deflating the header set.</p>
<p>Examples:</p>
<p>.. code-block:: json </p><pre class="fragment">{
  "cases":
  [
    {
      "seq": 0,
      "input_length": 66,
      "output_length": 20,
      "percentage_of_original_size": 30.303030303030305,
      "wire": "01881f3468e5891afcbf83868a3d856659c62e3f",
      "headers": [
        {
          ":authority": "example.org"
        },
        {
          ":method": "GET"
        },
        {
          ":path": "/"
        },
        {
          ":scheme": "https"
        },
        {
          "user-agent": "nghttp2"
        }
      ],
      "header_table_size": 4096
    }
    ,
    {
      "seq": 1,
      "input_length": 74,
      "output_length": 10,
      "percentage_of_original_size": 13.513513513513514,
      "wire": "88448504252dd5918485",
      "headers": [
        {
          ":authority": "example.org"
        },
        {
          ":method": "POST"
        },
        {
          ":path": "/account"
        },
        {
          ":scheme": "https"
        },
        {
          "user-agent": "nghttp2"
        }
      ],
      "header_table_size": 4096
    }
  ]
}
</pre><p>The output can be used as the input for <span class="tt">inflatehd</span> and <span class="tt">deflatehd</span>.</p>
<p>With the <span class="tt">-d</span> option, the extra <span class="tt">header_table</span> key is added and its associated value includes the state of dynamic header table after the corresponding header set was processed. The value includes at least the following keys:</p>
<p>entries The entry in the header table. If <span class="tt">referenced</span> is <span class="tt">true</span>, it is in the reference set. The <span class="tt">size</span> includes the overhead (32 bytes). The <span class="tt">index</span> corresponds to the index of header table. The <span class="tt">name</span> is the header field name and the <span class="tt">value</span> is the header field value.</p>
<p>size The sum of the spaces entries occupied, this includes the entry overhead.</p>
<p>max_size The maximum header table size.</p>
<p>deflate_size The sum of the spaces entries occupied within <span class="tt">max_deflate_size</span>.</p>
<p>max_deflate_size The maximum header table size the encoder uses. This can be smaller than <span class="tt">max_size</span>. In this case, the encoder only uses up to first <span class="tt">max_deflate_size</span> buffer. Since the header table size is still <span class="tt">max_size</span>, the encoder has to keep track of entries outside the <span class="tt">max_deflate_size</span> but inside the <span class="tt">max_size</span> and make sure that they are no longer referenced.</p>
<p>Example:</p>
<p>.. code-block:: json </p><pre class="fragment">{
  "cases":
  [
    {
      "seq": 0,
      "input_length": 66,
      "output_length": 20,
      "percentage_of_original_size": 30.303030303030305,
      "wire": "01881f3468e5891afcbf83868a3d856659c62e3f",
      "headers": [
        {
          ":authority": "example.org"
        },
        {
          ":method": "GET"
        },
        {
          ":path": "/"
        },
        {
          ":scheme": "https"
        },
        {
          "user-agent": "nghttp2"
        }
      ],
      "header_table_size": 4096,
      "header_table": {
        "entries": [
          {
            "index": 1,
            "name": "user-agent",
            "value": "nghttp2",
            "referenced": true,
            "size": 49
          },
          {
            "index": 2,
            "name": ":scheme",
            "value": "https",
            "referenced": true,
            "size": 44
          },
          {
            "index": 3,
            "name": ":path",
            "value": "/",
            "referenced": true,
            "size": 38
          },
          {
            "index": 4,
            "name": ":method",
            "value": "GET",
            "referenced": true,
            "size": 42
          },
          {
            "index": 5,
            "name": ":authority",
            "value": "example.org",
            "referenced": true,
            "size": 53
          }
        ],
        "size": 226,
        "max_size": 4096,
        "deflate_size": 226,
        "max_deflate_size": 4096
      }
    }
    ,
    {
      "seq": 1,
      "input_length": 74,
      "output_length": 10,
      "percentage_of_original_size": 13.513513513513514,
      "wire": "88448504252dd5918485",
      "headers": [
        {
          ":authority": "example.org"
        },
        {
          ":method": "POST"
        },
        {
          ":path": "/account"
        },
        {
          ":scheme": "https"
        },
        {
          "user-agent": "nghttp2"
        }
      ],
      "header_table_size": 4096,
      "header_table": {
        "entries": [
          {
            "index": 1,
            "name": ":method",
            "value": "POST",
            "referenced": true,
            "size": 43
          },
          {
            "index": 2,
            "name": "user-agent",
            "value": "nghttp2",
            "referenced": true,
            "size": 49
          },
          {
            "index": 3,
            "name": ":scheme",
            "value": "https",
            "referenced": true,
            "size": 44
          },
          {
            "index": 4,
            "name": ":path",
            "value": "/",
            "referenced": false,
            "size": 38
          },
          {
            "index": 5,
            "name": ":method",
            "value": "GET",
            "referenced": false,
            "size": 42
          },
          {
            "index": 6,
            "name": ":authority",
            "value": "example.org",
            "referenced": true,
            "size": 53
          }
        ],
        "size": 269,
        "max_size": 4096,
        "deflate_size": 269,
        "max_deflate_size": 4096
      }
    }
  ]
}
</pre><p>inflatehd - header decompressor +++++++++++++++++++++++++++++++</p>
<p>The <span class="tt">inflatehd</span> program reads JSON data from stdin and outputs decompressed name/value pairs in JSON.</p>
<p>The root JSON object must include the <span class="tt">cases</span> key. Its value has to include the sequence of compressed header blocks. They share the same compression context and are processed in the order they appear. Each item in the sequence is a JSON object and it must have at least a <span class="tt">wire</span> key. Its value is a compressed header block as a hex string.</p>
<p>Example:</p>
<p>.. code-block:: json </p><pre class="fragment">{
  "cases":
  [
    { "wire": "8285" },
    { "wire": "8583" }
  ]
}
</pre><p>The output is a JSON object. It should include a <span class="tt">cases</span> key and its value is an array of JSON objects, which has at least following keys:</p>
<p>seq The index of the header set in the input.</p>
<p>headers A JSON array that includes decompressed name/value pairs.</p>
<p>wire The compressed header block as a hex string.</p>
<p>header_table_size The header table size adjusted before inflating compressed header block.</p>
<p>Example:</p>
<p>.. code-block:: json </p><pre class="fragment">{
  "cases":
  [
    {
      "seq": 0,
      "wire": "01881f3468e5891afcbf83868a3d856659c62e3f",
      "headers": [
        {
          ":authority": "example.org"
        },
        {
          ":method": "GET"
        },
        {
          ":path": "/"
        },
        {
          ":scheme": "https"
        },
        {
          "user-agent": "nghttp2"
        }
      ],
      "header_table_size": 4096
    }
    ,
    {
      "seq": 1,
      "wire": "88448504252dd5918485",
      "headers": [
        {
          ":method": "POST"
        },
        {
          ":path": "/account"
        },
        {
          "user-agent": "nghttp2"
        },
        {
          ":scheme": "https"
        },
        {
          ":authority": "example.org"
        }
      ],
      "header_table_size": 4096
    }
  ]
}
</pre><p>The output can be used as the input for <span class="tt">deflatehd</span> and <span class="tt">inflatehd</span>.</p>
<p>With the <span class="tt">-d</span> option, the extra <span class="tt">header_table</span> key is added and its associated value includes the state of the dynamic header table after the corresponding header set was processed. The format is the same as <span class="tt">deflatehd</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md599"></a>
Contribution</h1>
<p>[This text was composed based on 1.2. License section of curl/libcurl project.]</p>
<p>When contributing with code, you agree to put your changes and new code under the same license nghttp2 is already using unless stated and agreed otherwise.</p>
<p>When changing existing source code, do not alter the copyright of the original file(s). The copyright will still be owned by the original creator(s) or those who have been assigned copyright by the original author(s).</p>
<p>By submitting a patch to the nghttp2 project, you (or your employer, as the case may be) agree to assign the copyright of your submission to us. .. the above really needs to be reworded to pass legal muster. We will credit you for your changes as far as possible, to give credit but also to keep a trace back to who made what changes. Please always provide us with your full real name when contributing!</p>
<p>See <span class="tt">Contribution Guidelines
&lt;<a href="https://nghttp2.org/documentation/contribute.html">https://nghttp2.org/documentation/contribute.html</a>&gt;</span>_ for more details.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md600"></a>
Versioning</h1>
<p>In general, we follow <span class="tt">Semantic Versioning &lt;<a href="http://semver.org/">http://semver.org/</a>&gt;</span>_.</p>
<p>We may release PATCH releases between the regular releases, mainly for severe security bug fixes.</p>
<p>We have no plan to break API compatibility changes involving soname bump, so MAJOR version will stay 1 for the foreseeable future.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md601"></a>
License</h1>
<p>The MIT License </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
