<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueBox: Boxing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueBox<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">BlueBox Bluetooth sink</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Boxing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md393"></a></p>
<p>The mruby objects and data are represented by C data type <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span>. There are three options how to pack the data values in the <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span>.</p>
<ul>
<li>Word Boxing</li>
<li>NaN Boxing</li>
<li>No Boxing</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md394"></a>
Word Boxing</h1>
<p>Word boxing packs the Ruby data in a word, which is a natural integer size that equals to the size of pointers (<span class="tt">intptr_t</span>). Word boxing can be specified by <span class="tt">MRB_WORD_BOXING</span>, and it's default configuration for most platforms.</p>
<p>Some values (called immediate values, e.g. integers, booleans, symbols, etc.) are directly packed in the word. The other data types are represented by pointers to the heap allocated structures.</p>
<p>The Word boxing packing bit patterns are like following:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Types  </th><th class="markdownTableHeadNone">Bit Pattern  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">object  </td><td class="markdownTableBodyNone"><span class="tt">xxxxxxxx xxxxxxxx xxxxxxxx xxxxx000</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">fixnum  </td><td class="markdownTableBodyNone"><span class="tt">xxxxxxxx xxxxxxxx xxxxxxxx xxxxxxx1</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nil  </td><td class="markdownTableBodyNone"><span class="tt">00000000 00000000 00000000 00000000</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone"><span class="tt">00000000 00000000 00000000 00001100</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone"><span class="tt">00000000 00000000 00000000 00000100</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">undef  </td><td class="markdownTableBodyNone"><span class="tt">00000000 00000000 00000000 00010100</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">symbol  </td><td class="markdownTableBodyNone"><span class="tt">xxxxxxxx xxxxxxxx xxxxxxxx xxxxxx10</span>  </td></tr>
</table>
<p>On 64-bit platforms (unless <span class="tt">MRB_WORDBOX_NO_FLOAT_TRUNCATE</span>), float values are also packed in the <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span>. In that case, we drop least significant 2 bits from mantissa. If you need full precision for floating-point numbers, define <span class="tt">MRB_WORDBOX_NO_FLOAT_TRUNCATE</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md395"></a>
NaN Boxing</h1>
<p>NaN boxing packs the Ruby data in a floating-point numbers, which represent NaN (Not a Number) values. Under IEEE753 definitions every value that exponent is all set are considered as NaN. That means NaN can represent <span class="tt">2^51</span> values. NaN boxing is a teaching to pack the values in those NaN representation. In theory, 64 bit pointers are too big to fit in NaN, but practically most OS use only 48 bits at most for pointers (except for some OS e.g. Solaris).</p>
<p>The NaN boxing packing bit patterns are like following:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Types  </th><th class="markdownTableHeadNone">Bit Pattern  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone"><span class="tt">SEEEEEEE EEEEFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">+/-inf  </td><td class="markdownTableBodyNone"><span class="tt">S1111111 11110000 00000000 00000000 00000000 00000000 00000000 00000000</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nan  </td><td class="markdownTableBodyNone"><span class="tt">01111111 11111000 00000000 00000000 00000000 00000000 00000000 00000000</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">fixnum  </td><td class="markdownTableBodyNone"><span class="tt">01111111 11111001 00000000 00000000 IIIIIIII IIIIIIII IIIIIIII IIIIIIII</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">symbol  </td><td class="markdownTableBodyNone"><span class="tt">01111111 11111110 00000000 00000000 SSSSSSSS SSSSSSSS SSSSSSSS SSSSSSSS</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">misc  </td><td class="markdownTableBodyNone"><span class="tt">01111111 11111111 00000000 00000000 00000000 00000000 00TTTTTT 0000MMMM</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">object  </td><td class="markdownTableBodyNone"><span class="tt">01111111 11111100 PPPPPPPP PPPPPPPP PPPPPPPP PPPPPPPP PPPPPPPP PPPPPP00</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ptr  </td><td class="markdownTableBodyNone"><span class="tt">01111111 11111100 PPPPPPPP PPPPPPPP PPPPPPPP PPPPPPPP PPPPPPPP PPPPPP01</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nil  </td><td class="markdownTableBodyNone"><span class="tt">00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000</span>  </td></tr>
</table>
<p>The object values appear far more frequently than floating-point numbers, so we offset the value so that object pointers are unchanged. This technique is called "favor pointer".</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md396"></a>
No Boxing</h1>
<p>No boxing represents <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span> by the C struct with <span class="tt">type</span> and the value union. This is the most portable (but inefficient) representation. No boxing can be specified by <span class="tt">MRB_NO_BOXING</span>, and it's default for debugging configuration (e.g. <span class="tt">host-debug</span>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
