<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueBox: mrbgems</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueBox<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">BlueBox Bluetooth sink</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">mrbgems </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md361"></a></p>
<p>mrbgems is a library manager to integrate C and Ruby extensions in an easy and standardised way into mruby. Conventionally, each mrbgem name is prefixed by <span class="tt">mruby-</span>, e.g. <span class="tt">mruby-time</span> for a gem that provides <span class="tt">Time</span> class functionality.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md362"></a>
Usage</h1>
<p>You have to activate mrbgems explicitly in your build configuration. To add a gem, add the following line to your build configuration file, for example:</p>
<div class="fragment"><div class="line">conf.gem &#39;/path/to/your/gem/dir&#39;</div>
</div><!-- fragment --><p>You can also use a relative path to specify a gem.</p>
<div class="fragment"><div class="line">conf.gem &#39;examples/mrbgems/ruby_extension_example&#39;</div>
</div><!-- fragment --><p>In that case,</p>
<ul>
<li>if your build configuration file is in the <span class="tt">build_config</span> directory, it's relative from <span class="tt">MRUBY_ROOT</span>.</li>
<li>otherwise, it is relative from the directory where your build configuration is.</li>
</ul>
<p>A remote GIT repository location for a GEM is also supported:</p>
<div class="fragment"><div class="line">conf.gem :git =&gt; &#39;https://github.com/masuidrive/mrbgems-example.git&#39;, :branch =&gt; &#39;master&#39;</div>
<div class="line">conf.gem :github =&gt; &#39;masuidrive/mrbgems-example&#39;, :branch =&gt; &#39;master&#39;</div>
<div class="line">conf.gem :bitbucket =&gt; &#39;mruby/mrbgems-example&#39;, :branch =&gt; &#39;master&#39;</div>
</div><!-- fragment --><p>NOTE: <span class="tt">:bitbucket</span> option supports only git. Hg is unsupported in this version.</p>
<p>You can specify the subdirectory of the repository with <span class="tt">:path</span> option:</p>
<div class="fragment"><div class="line">conf.gem github: &#39;mruby/mruby&#39;, path: &#39;mrbgems/mruby-socket&#39;</div>
</div><!-- fragment --><p>To use mrbgem from <a href="https://github.com/mruby/mgem-list">mgem-list</a> use <span class="tt">:mgem</span> option:</p>
<div class="fragment"><div class="line">conf.gem :mgem =&gt; &#39;mruby-yaml&#39;</div>
<div class="line">conf.gem :mgem =&gt; &#39;yaml&#39; # &#39;mruby-&#39; prefix could be omitted</div>
</div><!-- fragment --><p>For specifying the commit hash to checkout use <span class="tt">:checksum_hash</span> option:</p>
<div class="fragment"><div class="line">conf.gem mgem: &#39;mruby-redis&#39;, checksum_hash: &#39;3446d19fc4a3f9697b5ddbf2a904f301c42f2f4e&#39;</div>
</div><!-- fragment --><p>If there are missing dependencies, mrbgem dependencies solver will reference mrbgem from the core or mgem-list.</p>
<p>Note that if more than one git-based gem has the same base name (i.e. the default checkout directory name), it is (now) an error <b>UNLESS</b> they have the same repository URL, branch name and commit-id (i.e. checksum hash). You can bypass this by explicitly importing your preferred version <b>first</b> and setting the <span class="tt">canonical:</span> option to <span class="tt">true</span>:</p>
<div class="fragment"><div class="line">conf.gem github: &#39;me/mruby-yaml&#39;, branch: &#39;my-hacked-branch&#39;, canonical: true</div>
</div><!-- fragment --><p>If you do this, the system will (mostly) silently ignore other attempts to clone a gem with this name.</p>
<p>Note that this only affects cloning the gem from git. It does not resolve version conflicts. If the version as specified in the gem's rakefile is incompatible with a dependency, your build will still fail.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md363"></a>
Tweak the gem in your build configuration file</h2>
<p>You can give blocks in the <span class="tt">conf.gem</span> call to make adjustments for environments where the original gem does not expect them:</p>
<div class="fragment"><div class="line">conf.gem core: &quot;mruby-bin-mirb&quot; do |g|</div>
<div class="line">  # For cross build to NetBSD</div>
<div class="line">  g.linker.libraries = %w(edit termcap)</div>
<div class="line">end</div>
</div><!-- fragment --><p>However, it should be used with caution, as it may deviate from the intent of the gem's author.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md364"></a>
Gem Testing</h2>
<p>If you enable unit tests in your build with <span class="tt">enable_test</span>, tests will be generated for all gems and their dependencies by default. If necessary, it is possible to suppress tests for a specific gem like so:</p>
<div class="fragment"><div class="line">conf.gem &#39;mruby-noisygem&#39; do |g|</div>
<div class="line">  g.skip_test = true</div>
<div class="line">end</div>
</div><!-- fragment --><p>However, it is considered best practice to leave all tests enabled whenever possible. A warning message will be generated for each gem with disabled tests.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md365"></a>
GemBox</h1>
<p>There are instances when you wish to add a collection of mrbgems into mruby at once, or be able to substitute mrbgems based on configuration, without having to add each gem to your build configuration file. A packaged collection of mrbgems is called a GemBox. A GemBox is a file that contains a list of mrbgems to load into mruby, in the same format as if you were adding them to the build config via <span class="tt">config.gem</span>, but wrapped in an <span class="tt">MRuby::GemBox</span> object. GemBoxes are loaded into mruby via <span class="tt">config.gembox 'boxname'</span>.</p>
<p>Below we have created a GemBox containing <span class="tt">mruby-time</span> and <span class="tt">mrbgems-example</span>:</p>
<div class="fragment"><div class="line">MRuby::GemBox.new do |conf|</div>
<div class="line">  conf.gem &quot;#{root}/mrbgems/mruby-time&quot;</div>
<div class="line">  conf.gem :github =&gt; &#39;masuidrive/mrbgems-example&#39;</div>
<div class="line">end</div>
</div><!-- fragment --><p>As mentioned, the GemBox uses the same conventions as <span class="tt">MRuby::Build</span>. The GemBox must be saved with a <span class="tt">.gembox</span> extension inside the <span class="tt">mrbgems</span> directory to be picked up by mruby.</p>
<p>To use this example GemBox, we save it as <span class="tt">custom.gembox</span> inside the <span class="tt">mrbgems</span> directory in mruby, and add the following to your build configuration file inside the build block:</p>
<div class="fragment"><div class="line">conf.gembox &#39;custom&#39;</div>
</div><!-- fragment --><p>This will cause the <span class="tt">custom</span> GemBox to be read in during the build process, adding <span class="tt">mruby-time</span> and <span class="tt">mrbgems-example</span> to the build.</p>
<p>If you want, you can put GemBox outside the mruby directory. In that case you must specify an absolute path like below.</p>
<div class="fragment"><div class="line">conf.gembox &quot;#{ENV[&quot;HOME&quot;]}/mygemboxes/custom&quot;</div>
</div><!-- fragment --><p>There are two GemBoxes that ship with mruby: <a href="../../mrbgems/default.gembox">default</a> and <a href="../../mrbgems/full-core.gembox">full-core</a>. The <a href="../../mrbgems/default.gembox">default</a> GemBox contains several core components of mruby, and <a href="../../mrbgems/full-core.gembox">full-core</a> contains every gem found in the <span class="tt">mrbgems</span> directory.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md366"></a>
GEM Structure</h1>
<p>The maximal GEM structure looks like this:</p>
<div class="fragment"><div class="line">+- GEM_NAME             &lt;- Name of GEM</div>
<div class="line">    |</div>
<div class="line">    +- README.md        &lt;- Readme for GEM</div>
<div class="line">    |</div>
<div class="line">    +- mrbgem.rake      &lt;- GEM Specification</div>
<div class="line">    |</div>
<div class="line">    +- include/         &lt;- Header for Ruby extension (will exported)</div>
<div class="line">    |</div>
<div class="line">    +- mrblib/          &lt;- Source for Ruby extension</div>
<div class="line">    |</div>
<div class="line">    +- src/             &lt;- Source for C extension</div>
<div class="line">    |</div>
<div class="line">    +- tools/           &lt;- Source for Executable (in C)</div>
<div class="line">    |</div>
<div class="line">    +- test/            &lt;- Test code (Ruby)</div>
</div><!-- fragment --><p>The <span class="tt">mrblib</span> directory contains pure Ruby files to extend mruby. The <span class="tt">src</span> directory contains C/C++ files to extend mruby. The <span class="tt">include</span> directory contains C/C++ header files. The <span class="tt">test</span> directory contains C/C++ and pure Ruby files for testing purposes which will be used by <span class="tt">mrbtest</span>. <span class="tt">mrbgem.rake</span> contains the specification to compile C and Ruby files. <span class="tt">README.md</span> is a short description of your GEM.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md367"></a>
Build process</h1>
<p>mrbgems expects a specification file called <span class="tt">mrbgem.rake</span> inside of your GEM directory. A typical GEM specification could look like this for example:</p>
<div class="fragment"><div class="line">MRuby::Gem::Specification.new(&#39;c_and_ruby_extension_example&#39;) do |spec|</div>
<div class="line">  spec.license = &#39;MIT&#39;</div>
<div class="line">  spec.author  = &#39;mruby developers&#39;</div>
<div class="line">  spec.summary = &#39;Example mrbgem using C and Ruby&#39;</div>
<div class="line">end</div>
</div><!-- fragment --><p>The mrbgems build process will use this specification to compile Object and Ruby files. The compilation results will be added to <span class="tt">lib/libmruby.a</span>. This file exposes the GEM functionality to tools like <span class="tt">mruby</span> and <span class="tt">mirb</span>.</p>
<p>The following properties can be set inside your <span class="tt">MRuby::Gem::Specification</span> for information purpose:</p>
<ul>
<li><span class="tt">spec.license</span> or <span class="tt">spec.licenses</span> (A single license or a list of them under which this GEM is licensed)</li>
<li><span class="tt">spec.author</span> or <span class="tt">spec.authors</span> (Developer name or a list of them)</li>
<li><span class="tt">spec.version</span> (Current version)</li>
<li><span class="tt">spec.description</span> (Detailed description)</li>
<li><span class="tt">spec.summary</span><ul>
<li>One line short description of mrbgem.</li>
<li>Printed in build summary of rake when set.</li>
</ul>
</li>
<li><span class="tt">spec.homepage</span> (Homepage)</li>
<li><span class="tt">spec.requirements</span> (External requirements as information for user)</li>
</ul>
<p>The <span class="tt">license</span> and <span class="tt">author</span> properties are required in every GEM!</p>
<p>In case your GEM is depending on other GEMs please use <span class="tt">spec.add_dependency(gem, *requirements[, default_get_info])</span> like:</p>
<div class="fragment"><div class="line">MRuby::Gem::Specification.new(&#39;c_and_ruby_extension_example&#39;) do |spec|</div>
<div class="line">  spec.license = &#39;MIT&#39;</div>
<div class="line">  spec.author  = &#39;mruby developers&#39;</div>
<div class="line"> </div>
<div class="line">  # Add GEM dependency mruby-parser.</div>
<div class="line">  # The version must be between 1.0.0 and 1.5.2 .</div>
<div class="line">  spec.add_dependency(&#39;mruby-parser&#39;, &#39;&gt;= 1.0.0&#39;, &#39;&lt;= 1.5.2&#39;)</div>
<div class="line"> </div>
<div class="line">  # Use any version of mruby-uv from GitHub.</div>
<div class="line">  spec.add_dependency(&#39;mruby-uv&#39;, &#39;&gt;= 0.0.0&#39;, :github =&gt; &#39;mattn/mruby-uv&#39;)</div>
<div class="line"> </div>
<div class="line">  # Use latest mruby-onig-regexp from GitHub. (version requirements can be omitted)</div>
<div class="line">  spec.add_dependency(&#39;mruby-onig-regexp&#39;, :github =&gt; &#39;mattn/mruby-onig-regexp&#39;)</div>
<div class="line"> </div>
<div class="line">  # You can add extra mgems active only on test</div>
<div class="line">  spec.add_test_dependency(&#39;mruby-process&#39;, :github =&gt; &#39;iij/mruby-process&#39;)</div>
<div class="line">end</div>
</div><!-- fragment --><p>The version requirements and default gem information are optional.</p>
<p>Version requirement supports following operators:</p>
<ul>
<li>'=': is equal</li>
<li>'!=': is not equal</li>
<li>'&gt;': is greater</li>
<li>'&lt;': is lesser</li>
<li>'&gt;=': is equal or greater</li>
<li>'&lt;=': is equal or lesser</li>
<li>'~&gt;': is equal or greater and is lesser than the next major version<ul>
<li>example 1: '~&gt; 2.2.2' means '&gt;= 2.2.2' and '&lt; 2.3.0'</li>
<li>example 2: '~&gt; 2.2' means '&gt;= 2.2.0' and '&lt; 3.0.0'</li>
</ul>
</li>
</ul>
<p>When more than one version requirements is passed, the dependency must satisfy all of it.</p>
<p>You can have default gem to use as dependency when it's not defined in your build configuration. When the last argument of <span class="tt">add_dependency</span> call is <span class="tt">Hash</span>, it will be treated as default gem information. Its format is same as argument of method <span class="tt">MRuby::Build#gem</span>, expect that it can't be treated as path gem location.</p>
<p>When a special version of dependency is required, use <span class="tt">MRuby::Build#gem</span> in the build configuration to override default gem.</p>
<p>If you have conflicting GEMs use the following method:</p>
<ul>
<li><span class="tt">spec.add_conflict(gem, *requirements)</span><ul>
<li>The <span class="tt">requirements</span> argument is same as in <span class="tt">add_dependency</span> method.</li>
</ul>
</li>
</ul>
<p>like following code:</p>
<div class="fragment"><div class="line">MRuby::Gem::Specification.new &#39;some-regexp-binding&#39; do |spec|</div>
<div class="line">  spec.license = &#39;BSD&#39;</div>
<div class="line">  spec.author = &#39;John Doe&#39;</div>
<div class="line"> </div>
<div class="line">  spec.add_conflict &#39;mruby-onig-regexp&#39;, &#39;&gt; 0.0.0&#39;</div>
<div class="line">  spec.add_conflict &#39;mruby-hs-regexp&#39;</div>
<div class="line">  spec.add_conflict &#39;mruby-pcre-regexp&#39;</div>
<div class="line">  spec.add_conflict &#39;mruby-regexp-pcre&#39;</div>
<div class="line">end</div>
</div><!-- fragment --><p>In case your GEM has more complex build requirements you can use the following options additionally inside your GEM specification:</p>
<ul>
<li><span class="tt">spec.cc.flags</span> (C compiler flags)</li>
<li><span class="tt">spec.cc.defines</span> (C compiler defines)</li>
<li><span class="tt">spec.cc.include_paths</span> (C compiler include paths)</li>
<li><span class="tt">spec.linker.flags</span> (Linker flags)</li>
<li><span class="tt">spec.linker.libraries</span> (Linker libraries)</li>
<li><span class="tt">spec.linker.library_paths</span> (Linker additional library path)</li>
<li><span class="tt">spec.bins</span> (Generate binary file)</li>
<li><span class="tt">spec.rbfiles</span> (Ruby files to compile)</li>
<li><span class="tt">spec.objs</span> (Object files to compile)</li>
<li><span class="tt">spec.test_rbfiles</span> (Ruby test files for integration into mrbtest)</li>
<li><span class="tt">spec.test_objs</span> (Object test files for integration into mrbtest)</li>
<li><span class="tt">spec.test_preload</span> (Initialization files for mrbtest)</li>
</ul>
<p>You also can use <span class="tt">spec.mruby.cc</span> and <span class="tt">spec.mruby.linker</span> to add extra global parameters for the compiler and linker.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md368"></a>
include_paths and dependency</h2>
<p>Your GEM can export include paths to another GEMs that depends on your GEM. By default, <span class="tt">/...absolute path.../{GEM_NAME}/include</span> will be exported. So it is recommended not to put GEM's local header files on include/.</p>
<p>These exports are retroactive. For example: when B depends on C and A depends on B, A will get include paths exported by C.</p>
<p>Exported include_paths are automatically appended to GEM local include_paths by rake. You can use <span class="tt">spec.export_include_paths</span> accessor if you want more complex build.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md369"></a>
C Extension</h1>
<p>mruby can be extended with C. This is possible by using the C API to integrate C libraries into mruby.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md370"></a>
Preconditions</h2>
<p>mrbgems expects that you have implemented a C method called <span class="tt">mrb_YOURGEMNAME_gem_init(mrb_state)</span>. <span class="tt">YOURGEMNAME</span> will be replaced by the name of your GEM. If you call your GEM <span class="tt">c_extension_example</span>, your initialisation method could look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">mrb_c_extension_example_gem_init(<a class="code hl_struct" href="structmrb__state.html">mrb_state</a>* mrb) {</div>
<div class="line">  <span class="keyword">struct </span><a class="code hl_struct" href="structRClass.html">RClass</a> *class_cextension = mrb_define_module(mrb, <span class="stringliteral">&quot;CExtension&quot;</span>);</div>
<div class="line">  mrb_define_class_method(mrb, class_cextension, <span class="stringliteral">&quot;c_method&quot;</span>, mrb_c_method, <a class="code hl_define" href="mruby_8h.html#aa6e2ec577d218326a3546a7028b23c3c">MRB_ARGS_NONE</a>());</div>
<div class="line">}</div>
<div class="ttc" id="amruby_8h_html_aa6e2ec577d218326a3546a7028b23c3c"><div class="ttname"><a href="mruby_8h.html#aa6e2ec577d218326a3546a7028b23c3c">MRB_ARGS_NONE</a></div><div class="ttdeci">#define MRB_ARGS_NONE()</div><div class="ttdef"><b>Definition</b> mruby.h:919</div></div>
<div class="ttc" id="astructRClass_html"><div class="ttname"><a href="structRClass.html">RClass</a></div><div class="ttdef"><b>Definition</b> class.h:17</div></div>
<div class="ttc" id="astructmrb__state_html"><div class="ttname"><a href="structmrb__state.html">mrb_state</a></div><div class="ttdef"><b>Definition</b> mruby.h:256</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md371"></a>
Finalize</h2>
<p>mrbgems expects that you have implemented a C method called <span class="tt">mrb_YOURGEMNAME_gem_final(mrb_state)</span>. <span class="tt">YOURGEMNAME</span> will be replaced by the name of your GEM. If you call your GEM <span class="tt">c_extension_example</span>, your finalizer method could look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">mrb_c_extension_example_gem_final(<a class="code hl_struct" href="structmrb__state.html">mrb_state</a>* mrb) {</div>
<div class="line">  free(someone);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md372"></a>
Example</h2>
<div class="fragment"><div class="line">+- c_extension_example/</div>
<div class="line">    |</div>
<div class="line">    +- README.md        (Optional)</div>
<div class="line">    |</div>
<div class="line">    +- src/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.c    &lt;- C extension source</div>
<div class="line">    |</div>
<div class="line">    +- test/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.rb   &lt;- Test code for C extension</div>
<div class="line">    |</div>
<div class="line">    +- mrbgem.rake      &lt;- GEM specification</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md373"></a>
Ruby Extension</h1>
<p>mruby can be extended with pure Ruby. It is possible to override existing classes or add new ones in this way. Put all Ruby files into the <span class="tt">mrblib</span> directory.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md374"></a>
Pre-Conditions</h2>
<p>none</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md375"></a>
Example</h2>
<div class="fragment"><div class="line">+- ruby_extension_example/</div>
<div class="line">    |</div>
<div class="line">    +- README.md        (Optional)</div>
<div class="line">    |</div>
<div class="line">    +- mrblib/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.rb   &lt;- Ruby extension source</div>
<div class="line">    |</div>
<div class="line">    +- test/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.rb   &lt;- Test code for Ruby extension</div>
<div class="line">    |</div>
<div class="line">    +- mrbgem.rake      &lt;- GEM specification</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md376"></a>
C and Ruby Extension</h1>
<p>mruby can be extended with C and Ruby at the same time. It is possible to override existing classes or add new ones in this way. Put all Ruby files into the <span class="tt">mrblib</span> directory and all C files into the <span class="tt">src</span> directory.</p>
<p>mruby codes under <span class="tt">mrblib</span> directory would be executed after gem init C function is called. Make sure <em>mruby script</em> depends on <em>C code</em> and <em>C code</em> doesn't depend on <em>mruby script</em>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md377"></a>
Pre-Conditions</h2>
<p>See C and Ruby example.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md378"></a>
Example</h2>
<div class="fragment"><div class="line">+- c_and_ruby_extension_example/</div>
<div class="line">    |</div>
<div class="line">    +- README.md        (Optional)</div>
<div class="line">    |</div>
<div class="line">    +- mrblib/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.rb   &lt;- Ruby extension source</div>
<div class="line">    |</div>
<div class="line">    +- src/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.c    &lt;- C extension source</div>
<div class="line">    |</div>
<div class="line">    +- test/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.rb   &lt;- Test code for C and Ruby extension</div>
<div class="line">    |</div>
<div class="line">    +- mrbgem.rake      &lt;- GEM specification</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md379"></a>
Binary gems</h1>
<p>Some gems can generate executables under <span class="tt">bin</span> directory. Those gems are called binary gems. Names of binary gems are conventionally prefixed by <span class="tt">mruby-bin</span>, e.g. <span class="tt">mruby-bin-mirb</span> and <span class="tt">mruby-bin-strip</span>.</p>
<p>To specify the name of executable, you need to specify <span class="tt">spec.bins</span> in the <span class="tt">mrbgem.rake</span>. The entry point <span class="tt">main()</span> should be in the C source file under <span class="tt">tools/&lt;bin&gt;/*.c</span> where <span class="tt">&lt;bin&gt;</span> is a name of the executable. C files under the <span class="tt">&lt;bin&gt;</span> directory are compiled and linked to the executable, but not included in <span class="tt">libmruby.a</span>, whereas files under <span class="tt">mrblib</span> and <span class="tt">src</span> are.</p>
<p>It is strongly recommended not to include <span class="tt">mrblib</span> and <span class="tt">src</span> directories in the binary gems, to separate normal gems and binary gems.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md380"></a>
Example</h2>
<div class="fragment"><div class="line">+- mruby-bin-example/</div>
<div class="line">    |</div>
<div class="line">    +- README.md          (Optional)</div>
<div class="line">    |</div>
<div class="line">    +- bintest/</div>
<div class="line">    |   |</div>
<div class="line">    |   +- example.rb     &lt;- Test code for binary gem</div>
<div class="line">    |</div>
<div class="line">    +- mrbgem.rake        &lt;- Gem specification</div>
<div class="line">    |</div>
<div class="line">    +- mrblib/            &lt;- Source for Ruby extension (Optional)</div>
<div class="line">    |</div>
<div class="line">    +- src/               &lt;- Source for C extension (Optional)</div>
<div class="line">    |</div>
<div class="line">    +- tools/</div>
<div class="line">        |</div>
<div class="line">        +- example/       &lt;- Executable name directory</div>
<div class="line">            |</div>
<div class="line">            +- example.c  &lt;- Source for Executable (includes main)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
