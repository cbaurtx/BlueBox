<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueBox: A2DP SINK 流例程</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueBox<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">BlueBox Bluetooth sink</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">A2DP SINK 流例程 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md615"></a></p>
<ul>
<li><a class="el" href="index.html#md_README">English Version</a></li>
<li>例程难度：<img src="../../../docs/_static/level_basic.png" alt="alt text" title="初级" class="inline"/></li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md616"></a>
例程简介</h1>
<p>本例程是 A2DP SINK 例程，使用经典蓝牙的 A2DP 协议进行音频流分发接收，使用 AVRCP 协议进行媒体信息通知控制。蓝牙音箱或者蓝牙耳机等应用可以用此示例作为基本功能参考。</p>
<p>A2DP SINK 的完整管道如下：</p>
<div class="fragment"><div class="line">aadp_source ---&gt; aadp_sink_stream ---&gt; i2s_stream_writer ---&gt; codec_chip ---&gt; speaker</div>
</div><!-- fragment --><p>本例程作为 A2DP 的 SINK 角色，需要和 A2DP SOURCE（一般可以是手机）配对连接，用来播放 A2DP SOURCE 下发的音频。</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md617"></a>
环境配置</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md618"></a>
硬件要求</h2>
<p>本例程支持的开发板在 <span class="tt">$ADF_PATH/examples/README_CN.md</span> 文档中<a href="../../README_CN.md#例程与乐鑫音频开发板的兼容性">例程与乐鑫音频开发板的兼容性表格</a>中有标注，表格中标有绿色复选框的开发板均可运行本例程。请记住，如下面的 配置 一节所述，可以在 <span class="tt">menuconfig</span> 中选择开发板。</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md619"></a>
编译和下载</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md620"></a>
IDF 默认分支</h2>
<p>本例程支持 IDF release/v5.0 及以后的分支，例程默认使用 ADF 的內建分支 <span class="tt">$ADF_PATH/esp-idf</span>。</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md621"></a>
配置</h2>
<p>本例程默认选择的开发板是 <span class="tt">ESP32-Lyrat V4.3</span>，如果需要在其他的开发板上运行此例程，则需要在 menuconfig 中选择开发板的配置，例如选择 <span class="tt">ESP32-Lyrat-Mini V1.1</span>。</p>
<div class="fragment"><div class="line">menuconfig &gt; Audio HAL &gt; ESP32-Lyrat-Mini V1.1</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md622"></a>
编译和下载</h2>
<p>请先编译版本并烧录到开发板上，然后运行 monitor 工具来查看串口输出 (替换 PORT 为端口名称)：</p>
<div class="fragment"><div class="line">idf.py -p PORT flash monitor</div>
</div><!-- fragment --><p>退出调试界面使用 <span class="tt">Ctrl-]</span>。</p>
<p>有关配置和使用 ESP-IDF 生成项目的完整步骤，请参阅 <a href="https://docs.espressif.com/projects/esp-idf/zh_CN/release-v5.3/esp32/index.html">《ESP-IDF 编程指南》</a>。</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md623"></a>
如何使用例程</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md624"></a>
功能和用法</h2>
<ul>
<li>例程开始运行后，开发板等待用户的手机进行蓝牙连接操作，打印如下：</li>
</ul>
<div class="fragment"><div class="line">entry 0x400806f4</div>
<div class="line">I (27) boot: ESP-IDF v4.2.2 2nd stage bootloader</div>
<div class="line">I (27) boot: compile time 17:03:07</div>
<div class="line">I (27) boot: chip revision: 3</div>
<div class="line">I (30) boot_comm: chip revision: 3, min. bootloader chip revision: 0</div>
<div class="line">I (37) boot.esp32: SPI Speed      : 40MHz</div>
<div class="line">I (42) boot.esp32: SPI Mode       : DIO</div>
<div class="line">I (46) boot.esp32: SPI Flash Size : 2MB</div>
<div class="line">I (51) boot: Enabling RNG early entropy source...</div>
<div class="line">I (56) boot: Partition Table:</div>
<div class="line">I (60) boot: <span class="preprocessor">## Label            Usage          Type ST Offset   Length</span></div>
<div class="line">I (67) boot:  0 nvs              WiFi data        01 02 00009000 00006000</div>
<div class="line">I (75) boot:  1 phy_init         RF data          01 01 0000f000 00001000</div>
<div class="line">I (82) boot:  2 factory          factory app      00 00 00010000 00124f80</div>
<div class="line">I (90) boot: End of partition table</div>
<div class="line">I (94) boot_comm: chip revision: 3, min. application chip revision: 0</div>
<div class="line">I (101) esp_image: segment 0: paddr=0x00010020 vaddr=0x3f400020 size=0x2c878 (182392) map</div>
<div class="line">I (179) esp_image: segment 1: paddr=0x0003c8a0 vaddr=0x3ffbdb60 size=0x0344c ( 13388) load</div>
<div class="line">I (185) esp_image: segment 2: paddr=0x0003fcf4 vaddr=0x40080000 size=0x00324 (   804) load</div>
<div class="line">0x40080000: _WindowOverflow4 at /hengyongchao/esp-idfs/esp-idf-v4.2.2/components/freertos/xtensa/xtensa_vectors.S:1730</div>
<div class="line"> </div>
<div class="line">I (186) esp_image: segment 3: paddr=0x00040020 vaddr=0x400d0020 size=0xae738 (714552) map</div>
<div class="line">0x400d0020: _stext at ??:?</div>
<div class="line"> </div>
<div class="line">I (467) esp_image: segment 4: paddr=0x000ee760 vaddr=0x40080324 size=0x1701c ( 94236) load</div>
<div class="line">0x40080324: _KernelExceptionVector at ??:?</div>
<div class="line"> </div>
<div class="line">I (521) boot: Loaded app from partition at offset 0x10000</div>
<div class="line">I (521) boot: Disabling RNG early entropy source...</div>
<div class="line">I (522) cpu_start: Pro cpu up.</div>
<div class="line">I (525) cpu_start: Application information:</div>
<div class="line">I (530) cpu_start: Project name:     bt_sink_demo</div>
<div class="line">I (535) cpu_start: App version:      v2.2-201-g6fa02923</div>
<div class="line">I (541) cpu_start: Compile time:     Sep 30 2021 17:03:01</div>
<div class="line">I (547) cpu_start: ELF file SHA256:  70fe532bd3fbc1b2...</div>
<div class="line">I (553) cpu_start: ESP-IDF:          v4.2.2</div>
<div class="line">I (558) cpu_start: Starting app cpu, entry point is 0x40081a18</div>
<div class="line">0x40081a18: call_start_cpu1 at /hengyongchao/esp-idfs/esp-idf-v4.2.2/components/esp32/cpu_start.c:287</div>
<div class="line"> </div>
<div class="line">I (0) cpu_start: App cpu up.</div>
<div class="line">I (569) heap_init: Initializing. RAM available for dynamic allocation:</div>
<div class="line">I (576) heap_init: At 3FFAFF10 len 000000F0 (0 KiB): DRAM</div>
<div class="line">I (582) heap_init: At 3FFB6388 len 00001C78 (7 KiB): DRAM</div>
<div class="line">I (588) heap_init: At 3FFB9A20 len 00004108 (16 KiB): DRAM</div>
<div class="line">I (594) heap_init: At 3FFCF0E0 len 00010F20 (67 KiB): DRAM</div>
<div class="line">I (600) heap_init: At 3FFE0440 len 00003AE0 (14 KiB): D/IRAM</div>
<div class="line">I (606) heap_init: At 3FFE4350 len 0001BCB0 (111 KiB): D/IRAM</div>
<div class="line">I (613) heap_init: At 40097340 len 00008CC0 (35 KiB): IRAM</div>
<div class="line">I (619) cpu_start: Pro cpu start user code</div>
<div class="line">I (637) spi_flash: detected chip: gd</div>
<div class="line">I (638) spi_flash: flash io: dio</div>
<div class="line">W (638) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.</div>
<div class="line">I (648) cpu_start: Starting scheduler on PRO CPU.</div>
<div class="line">I (0) cpu_start: Starting scheduler on APP CPU.</div>
<div class="line">I (695) BLUETOOTH_EXAMPLE: [ 1 ] Init Bluetooth</div>
<div class="line">I (695) BTDM_INIT: BT controller compile version [ba56601]</div>
<div class="line">I (695) system_api: Base MAC address is not set</div>
<div class="line">I (695) system_api: read default base MAC address from EFUSE</div>
<div class="line">I (705) phy_init: phy_version 4660,0162888,Dec 23 2020</div>
<div class="line">I (1395) BLUETOOTH_EXAMPLE: [ 2 ] Start codec chip</div>
<div class="line">I (1405) gpio: GPIO[19]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:3</div>
<div class="line">I (1425) gpio: GPIO[21]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (1425) ES8388_DRIVER: init,out:02, in:00</div>
<div class="line">I (1435) AUDIO_HAL: Codec mode is 2, Ctrl:1</div>
<div class="line">I (1435) BLUETOOTH_EXAMPLE: [ 3 ] Create audio pipeline for playback</div>
<div class="line">I (1435) BLUETOOTH_EXAMPLE: [4] Create i2s stream to write data to codec chip</div>
<div class="line">I (1445) I2S: DMA Malloc info, datalen=blocksize=1200, dma_buf_count=3</div>
<div class="line">I (1455) I2S: DMA Malloc info, datalen=blocksize=1200, dma_buf_count=3</div>
<div class="line">I (1485) I2S: APLL: Req RATE: 44100, real rate: 44099.988, BITS: 16, CLKM: 1, BCK_M: 8, MCLK: 11289597.000, SCLK: 1411199.625000, diva: 1, divb: 0</div>
<div class="line">I (1485) LYRAT_V4_3: I2S0, MCLK output by GPIO0</div>
<div class="line">I (1495) BLUETOOTH_EXAMPLE: [4.1] Get Bluetooth stream</div>
<div class="line">W (1495) BT_BTC: A2DP Enable with AVRC</div>
<div class="line">I (1515) A2DP_STREAM: Unhandled A2DP event: 4</div>
<div class="line">I (1515) BLUETOOTH_EXAMPLE: [4.2] Register all elements to audio pipeline</div>
<div class="line">I (1515) BLUETOOTH_EXAMPLE: [4.3] Link it together [Bluetooth]--&gt;bt_stream_reader--&gt;i2s_stream_writer--&gt;[codec_chip]</div>
<div class="line">I (1535) AUDIO_PIPELINE: link el-&gt;rb, el:0x3ffd7c74, tag:bt, rb:0x3ffd80e0</div>
<div class="line">I (1535) BLUETOOTH_EXAMPLE: [ 5 ] Initialize peripherals</div>
<div class="line">E (1545) gpio: gpio_install_isr_service(438): GPIO isr service already installed</div>
<div class="line">I (1555) gpio: GPIO[36]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:3</div>
<div class="line">I (1565) gpio: GPIO[39]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:3</div>
<div class="line">I (1575) BLUETOOTH_EXAMPLE: [ 5.1 ] Create and start input key service</div>
<div class="line">I (1575) BLUETOOTH_EXAMPLE: [5.2] Create Bluetooth peripheral</div>
<div class="line">W (1595) PERIPH_TOUCH: _touch_init</div>
<div class="line">I (1595) BLUETOOTH_EXAMPLE: [5.3] Start all peripherals</div>
<div class="line">I (1595) BLUETOOTH_EXAMPLE: [ 6 ] Set up  event listener</div>
<div class="line">I (1605) BLUETOOTH_EXAMPLE: [6.1] Listening event from all elements of pipeline</div>
<div class="line">I (1615) BLUETOOTH_EXAMPLE: [ 7 ] Start audio_pipeline</div>
<div class="line">I (1615) AUDIO_ELEMENT: [bt-0x3ffd7c74] Element task created</div>
<div class="line">I (1635) AUDIO_ELEMENT: [i2s-0x3ffd5f10] Element task created</div>
<div class="line">I (1635) AUDIO_PIPELINE: Func:audio_pipeline_run, Line:359, MEM Total:133036 Bytes</div>
<div class="line"> </div>
<div class="line">I (1645) AUDIO_ELEMENT: [i2s] AEL_MSG_CMD_RESUME,state:1</div>
<div class="line">I (1645) I2S_STREAM: AUDIO_STREAM_WRITER</div>
<div class="line">I (1655) AUDIO_PIPELINE: Pipeline started</div>
<div class="line">I (1655) BLUETOOTH_EXAMPLE: [ 8 ] Listen for all pipeline events</div>
</div><!-- fragment --><ul>
<li>用户使用手机蓝牙扫描，搜索到名为 <span class="tt">ESP_SINK_STREAM_DEMO</span> 的蓝牙设备然后点击连接，打印如下：</li>
</ul>
<div class="fragment"><div class="line">E (265275) BT_APPL: bta_av_rc_create ACP handle exist for shdl:0</div>
<div class="line">I (265285) A2DP_STREAM: A2DP bd address:, [14:60:cb:82:72:55]</div>
<div class="line">I (265305) A2DP_STREAM: AVRC conn_state evt: state 1, [14:60:cb:82:72:55]</div>
<div class="line">I (265455) A2DP_STREAM: A2DP audio stream configuration, codec type 0</div>
<div class="line">I (265455) A2DP_STREAM: Bluetooth configured, sample rate=44100</div>
<div class="line">I (265465) BLUETOOTH_EXAMPLE: [ * ] Receive music info from Bluetooth, sample_rates=44100, bits=16, ch=2</div>
<div class="line">I (265495) AUDIO_ELEMENT: [i2s] AEL_MSG_CMD_PAUSE</div>
<div class="line">I (265545) I2S: APLL: Req RATE: 44100, real rate: 44099.988, BITS: 16, CLKM: 1, BCK_M: 8, MCLK: 11289597.000, SCLK: 1411199.625000, diva: 1, divb: 0</div>
<div class="line">I (265545) AUDIO_ELEMENT: [i2s] AEL_MSG_CMD_RESUME,state:4</div>
<div class="line">I (265555) I2S_STREAM: AUDIO_STREAM_WRITER</div>
<div class="line">I (265855) A2DP_STREAM: AVRC remote features 25b, CT features 2</div>
<div class="line">W (265995) BT_APPL: new conn_srvc <span class="keywordtype">id</span>:19, app_id:0</div>
<div class="line">I (265995) A2DP_STREAM: A2DP bd address:, [14:60:cb:82:72:55]</div>
<div class="line">I (265995) A2DP_STREAM: A2DP connection state =  CONNECTED</div>
<div class="line">I (266535) A2DP_STREAM: AVRC remote features 25b, CT features 2</div>
<div class="line">I (266605) A2DP_STREAM: AVRC register event notification: 13, param: 0x0</div>
<div class="line">I (266615) A2DP_STREAM: AVRC set absolute volume: 40%</div>
<div class="line">I (266615) A2DP_STREAM: Volume is set by remote controller 40%</div>
</div><!-- fragment --><ul>
<li>蓝牙连接成功后，手机打开播放器，点击播放，那么开发板就会输出手机蓝牙下发的音频，打印如下：</li>
</ul>
<div class="fragment"><div class="line">I (294305) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (294305) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (294335) BT_LOG: bta_av_link_role_ok hndl:x41 role:1 conn_audio:x1 bits:1 features:x824b</div>
<div class="line"> </div>
<div class="line">W (294335) BT_APPL: new conn_srvc <span class="keywordtype">id</span>:19, app_id:1</div>
<div class="line">I (315545) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (315545) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (322135) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (322135) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (327765) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (327765) A2DP_STREAM: Volume is set by remote controller 23%</div>
</div><!-- fragment --><ul>
<li>本例程还支持 AVRCP 进行媒体播放操作控制，如音量加、音量减、下一曲、上一曲等，打印如下：</li>
</ul>
<div class="fragment"><div class="line">I (327765) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (327765) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (330095) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (330095) A2DP_STREAM: Volume is set by remote controller 29%</div>
<div class="line"> </div>
<div class="line">I (331115) A2DP_STREAM: AVRC set absolute volume: 36%</div>
<div class="line">I (331115) A2DP_STREAM: Volume is set by remote controller 36%</div>
<div class="line"> </div>
<div class="line">I (332935) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (332935) A2DP_STREAM: Volume is set by remote controller 29%</div>
<div class="line"> </div>
<div class="line">I (333695) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (333695) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (337975) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (337975) A2DP_STREAM: Volume is set by remote controller 29%</div>
<div class="line"> </div>
<div class="line">I (345145) A2DP_STREAM: AVRC set absolute volume: 62%</div>
<div class="line">I (345145) A2DP_STREAM: Volume is set by remote controller 62%</div>
<div class="line"> </div>
<div class="line">I (345155) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (345155) A2DP_STREAM: Volume is set by remote controller 29%</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md625"></a>
日志输出</h2>
<p>以下为本例程的完整日志。</p>
<div class="fragment"><div class="line">entry 0x400806f4</div>
<div class="line">I (27) boot: ESP-IDF v4.2.2 2nd stage bootloader</div>
<div class="line">I (27) boot: compile time 17:03:07</div>
<div class="line">I (27) boot: chip revision: 3</div>
<div class="line">I (30) boot_comm: chip revision: 3, min. bootloader chip revision: 0</div>
<div class="line">I (37) boot.esp32: SPI Speed      : 40MHz</div>
<div class="line">I (42) boot.esp32: SPI Mode       : DIO</div>
<div class="line">I (46) boot.esp32: SPI Flash Size : 2MB</div>
<div class="line">I (51) boot: Enabling RNG early entropy source...</div>
<div class="line">I (56) boot: Partition Table:</div>
<div class="line">I (60) boot: <span class="preprocessor">## Label            Usage          Type ST Offset   Length</span></div>
<div class="line">I (67) boot:  0 nvs              WiFi data        01 02 00009000 00006000</div>
<div class="line">I (75) boot:  1 phy_init         RF data          01 01 0000f000 00001000</div>
<div class="line">I (82) boot:  2 factory          factory app      00 00 00010000 00124f80</div>
<div class="line">I (90) boot: End of partition table</div>
<div class="line">I (94) boot_comm: chip revision: 3, min. application chip revision: 0</div>
<div class="line">I (101) esp_image: segment 0: paddr=0x00010020 vaddr=0x3f400020 size=0x2c878 (182392) map</div>
<div class="line">I (179) esp_image: segment 1: paddr=0x0003c8a0 vaddr=0x3ffbdb60 size=0x0344c ( 13388) load</div>
<div class="line">I (185) esp_image: segment 2: paddr=0x0003fcf4 vaddr=0x40080000 size=0x00324 (   804) load</div>
<div class="line">0x40080000: _WindowOverflow4 at /hengyongchao/esp-idfs/esp-idf-v4.2.2/components/freertos/xtensa/xtensa_vectors.S:1730</div>
<div class="line"> </div>
<div class="line">I (186) esp_image: segment 3: paddr=0x00040020 vaddr=0x400d0020 size=0xae738 (714552) map</div>
<div class="line">0x400d0020: _stext at ??:?</div>
<div class="line"> </div>
<div class="line">I (467) esp_image: segment 4: paddr=0x000ee760 vaddr=0x40080324 size=0x1701c ( 94236) load</div>
<div class="line">0x40080324: _KernelExceptionVector at ??:?</div>
<div class="line"> </div>
<div class="line">I (521) boot: Loaded app from partition at offset 0x10000</div>
<div class="line">I (521) boot: Disabling RNG early entropy source...</div>
<div class="line">I (522) cpu_start: Pro cpu up.</div>
<div class="line">I (525) cpu_start: Application information:</div>
<div class="line">I (530) cpu_start: Project name:     bt_sink_demo</div>
<div class="line">I (535) cpu_start: App version:      v2.2-201-g6fa02923</div>
<div class="line">I (541) cpu_start: Compile time:     Sep 30 2021 17:03:01</div>
<div class="line">I (547) cpu_start: ELF file SHA256:  70fe532bd3fbc1b2...</div>
<div class="line">I (553) cpu_start: ESP-IDF:          v4.2.2</div>
<div class="line">I (558) cpu_start: Starting app cpu, entry point is 0x40081a18</div>
<div class="line">0x40081a18: call_start_cpu1 at /hengyongchao/esp-idfs/esp-idf-v4.2.2/components/esp32/cpu_start.c:287</div>
<div class="line"> </div>
<div class="line">I (0) cpu_start: App cpu up.</div>
<div class="line">I (569) heap_init: Initializing. RAM available for dynamic allocation:</div>
<div class="line">I (576) heap_init: At 3FFAFF10 len 000000F0 (0 KiB): DRAM</div>
<div class="line">I (582) heap_init: At 3FFB6388 len 00001C78 (7 KiB): DRAM</div>
<div class="line">I (588) heap_init: At 3FFB9A20 len 00004108 (16 KiB): DRAM</div>
<div class="line">I (594) heap_init: At 3FFCF0E0 len 00010F20 (67 KiB): DRAM</div>
<div class="line">I (600) heap_init: At 3FFE0440 len 00003AE0 (14 KiB): D/IRAM</div>
<div class="line">I (606) heap_init: At 3FFE4350 len 0001BCB0 (111 KiB): D/IRAM</div>
<div class="line">I (613) heap_init: At 40097340 len 00008CC0 (35 KiB): IRAM</div>
<div class="line">I (619) cpu_start: Pro cpu start user code</div>
<div class="line">I (637) spi_flash: detected chip: gd</div>
<div class="line">I (638) spi_flash: flash io: dio</div>
<div class="line">W (638) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.</div>
<div class="line">I (648) cpu_start: Starting scheduler on PRO CPU.</div>
<div class="line">I (0) cpu_start: Starting scheduler on APP CPU.</div>
<div class="line">I (695) BLUETOOTH_EXAMPLE: [ 1 ] Init Bluetooth</div>
<div class="line">I (695) BTDM_INIT: BT controller compile version [ba56601]</div>
<div class="line">I (695) system_api: Base MAC address is not set</div>
<div class="line">I (695) system_api: read default base MAC address from EFUSE</div>
<div class="line">I (705) phy_init: phy_version 4660,0162888,Dec 23 2020</div>
<div class="line">I (1395) BLUETOOTH_EXAMPLE: [ 2 ] Start codec chip</div>
<div class="line">I (1405) gpio: GPIO[19]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:3</div>
<div class="line">I (1425) gpio: GPIO[21]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (1425) ES8388_DRIVER: init,out:02, in:00</div>
<div class="line">I (1435) AUDIO_HAL: Codec mode is 2, Ctrl:1</div>
<div class="line">I (1435) BLUETOOTH_EXAMPLE: [ 3 ] Create audio pipeline for playback</div>
<div class="line">I (1435) BLUETOOTH_EXAMPLE: [4] Create i2s stream to write data to codec chip</div>
<div class="line">I (1445) I2S: DMA Malloc info, datalen=blocksize=1200, dma_buf_count=3</div>
<div class="line">I (1455) I2S: DMA Malloc info, datalen=blocksize=1200, dma_buf_count=3</div>
<div class="line">I (1485) I2S: APLL: Req RATE: 44100, real rate: 44099.988, BITS: 16, CLKM: 1, BCK_M: 8, MCLK: 11289597.000, SCLK: 1411199.625000, diva: 1, divb: 0</div>
<div class="line">I (1485) LYRAT_V4_3: I2S0, MCLK output by GPIO0</div>
<div class="line">I (1495) BLUETOOTH_EXAMPLE: [4.1] Get Bluetooth stream</div>
<div class="line">W (1495) BT_BTC: A2DP Enable with AVRC</div>
<div class="line">I (1515) A2DP_STREAM: Unhandled A2DP event: 4</div>
<div class="line">I (1515) BLUETOOTH_EXAMPLE: [4.2] Register all elements to audio pipeline</div>
<div class="line">I (1515) BLUETOOTH_EXAMPLE: [4.3] Link it together [Bluetooth]--&gt;bt_stream_reader--&gt;i2s_stream_writer--&gt;[codec_chip]</div>
<div class="line">I (1535) AUDIO_PIPELINE: link el-&gt;rb, el:0x3ffd7c74, tag:bt, rb:0x3ffd80e0</div>
<div class="line">I (1535) BLUETOOTH_EXAMPLE: [ 5 ] Initialize peripherals</div>
<div class="line">E (1545) gpio: gpio_install_isr_service(438): GPIO isr service already installed</div>
<div class="line">I (1555) gpio: GPIO[36]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:3</div>
<div class="line">I (1565) gpio: GPIO[39]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 1| Pulldown: 0| Intr:3</div>
<div class="line">I (1575) BLUETOOTH_EXAMPLE: [ 5.1 ] Create and start input key service</div>
<div class="line">I (1575) BLUETOOTH_EXAMPLE: [5.2] Create Bluetooth peripheral</div>
<div class="line">W (1595) PERIPH_TOUCH: _touch_init</div>
<div class="line">I (1595) BLUETOOTH_EXAMPLE: [5.3] Start all peripherals</div>
<div class="line">I (1595) BLUETOOTH_EXAMPLE: [ 6 ] Set up  event listener</div>
<div class="line">I (1605) BLUETOOTH_EXAMPLE: [6.1] Listening event from all elements of pipeline</div>
<div class="line">I (1615) BLUETOOTH_EXAMPLE: [ 7 ] Start audio_pipeline</div>
<div class="line">I (1615) AUDIO_ELEMENT: [bt-0x3ffd7c74] Element task created</div>
<div class="line">I (1635) AUDIO_ELEMENT: [i2s-0x3ffd5f10] Element task created</div>
<div class="line">I (1635) AUDIO_PIPELINE: Func:audio_pipeline_run, Line:359, MEM Total:133036 Bytes</div>
<div class="line"> </div>
<div class="line">I (1645) AUDIO_ELEMENT: [i2s] AEL_MSG_CMD_RESUME,state:1</div>
<div class="line">I (1645) I2S_STREAM: AUDIO_STREAM_WRITER</div>
<div class="line">I (1655) AUDIO_PIPELINE: Pipeline started</div>
<div class="line">I (1655) BLUETOOTH_EXAMPLE: [ 8 ] Listen for all pipeline events</div>
<div class="line">E (265275) BT_APPL: bta_av_rc_create ACP handle exist for shdl:0</div>
<div class="line">I (265285) A2DP_STREAM: A2DP bd address:, [14:60:cb:82:72:55]</div>
<div class="line">I (265305) A2DP_STREAM: AVRC conn_state evt: state 1, [14:60:cb:82:72:55]</div>
<div class="line">I (265455) A2DP_STREAM: A2DP audio stream configuration, codec type 0</div>
<div class="line">I (265455) A2DP_STREAM: Bluetooth configured, sample rate=44100</div>
<div class="line">I (265465) BLUETOOTH_EXAMPLE: [ * ] Receive music info from Bluetooth, sample_rates=44100, bits=16, ch=2</div>
<div class="line">I (265495) AUDIO_ELEMENT: [i2s] AEL_MSG_CMD_PAUSE</div>
<div class="line">I (265545) I2S: APLL: Req RATE: 44100, real rate: 44099.988, BITS: 16, CLKM: 1, BCK_M: 8, MCLK: 11289597.000, SCLK: 1411199.625000, diva: 1, divb: 0</div>
<div class="line">I (265545) AUDIO_ELEMENT: [i2s] AEL_MSG_CMD_RESUME,state:4</div>
<div class="line">I (265555) I2S_STREAM: AUDIO_STREAM_WRITER</div>
<div class="line">I (265855) A2DP_STREAM: AVRC remote features 25b, CT features 2</div>
<div class="line">W (265995) BT_APPL: new conn_srvc <span class="keywordtype">id</span>:19, app_id:0</div>
<div class="line">I (265995) A2DP_STREAM: A2DP bd address:, [14:60:cb:82:72:55]</div>
<div class="line">I (265995) A2DP_STREAM: A2DP connection state =  CONNECTED</div>
<div class="line">I (266535) A2DP_STREAM: AVRC remote features 25b, CT features 2</div>
<div class="line">I (266605) A2DP_STREAM: AVRC register event notification: 13, param: 0x0</div>
<div class="line">I (266615) A2DP_STREAM: AVRC set absolute volume: 40%</div>
<div class="line">I (266615) A2DP_STREAM: Volume is set by remote controller 40%</div>
<div class="line"> </div>
<div class="line">I (294305) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (294305) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (294335) BT_LOG: bta_av_link_role_ok hndl:x41 role:1 conn_audio:x1 bits:1 features:x824b</div>
<div class="line"> </div>
<div class="line">W (294335) BT_APPL: new conn_srvc <span class="keywordtype">id</span>:19, app_id:1</div>
<div class="line">I (315545) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (315545) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (322135) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (322135) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (327765) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (327765) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (330095) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (330095) A2DP_STREAM: Volume is set by remote controller 29%</div>
<div class="line"> </div>
<div class="line">I (331115) A2DP_STREAM: AVRC set absolute volume: 36%</div>
<div class="line">I (331115) A2DP_STREAM: Volume is set by remote controller 36%</div>
<div class="line"> </div>
<div class="line">I (332935) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (332935) A2DP_STREAM: Volume is set by remote controller 29%</div>
<div class="line"> </div>
<div class="line">I (333695) A2DP_STREAM: AVRC set absolute volume: 23%</div>
<div class="line">I (333695) A2DP_STREAM: Volume is set by remote controller 23%</div>
<div class="line"> </div>
<div class="line">I (337975) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (337975) A2DP_STREAM: Volume is set by remote controller 29%</div>
<div class="line"> </div>
<div class="line">I (345145) A2DP_STREAM: AVRC set absolute volume: 62%</div>
<div class="line">I (345145) A2DP_STREAM: Volume is set by remote controller 62%</div>
<div class="line"> </div>
<div class="line">I (345155) A2DP_STREAM: AVRC set absolute volume: 29%</div>
<div class="line">I (345155) A2DP_STREAM: Volume is set by remote controller 29%</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md626"></a>
故障排除</h1>
<ul>
<li>ESP32 A2DP 强制支持的音频编解码器是 SBC。SBC 数据流传输到 A2DP SINK，然后解码为 PCM 数据输出。PCM 数据格式通常为 44.1 kHz 采样率、双通道、16 位采样数据流。当然也支持 ESP32 A2DP SINK 中的其他解码器配置，但需要额外修改协议栈设置。</li>
<li>ESP32 A2DP SINK 最多只能支持与一个远程 A2DP SOURCE 设备的连接。此外，A2DP SINK 不能与 A2DP SOURCE 同时使用，但可以与其他配置文件一起使用，例如 SPP 和 HFP。</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md627"></a>
技术支持</h1>
<p>请按照下面的链接获取技术支持：</p>
<ul>
<li>技术支持参见 <a href="https://esp32.com/viewforum.php?f=20">esp32.com</a> 论坛</li>
<li>故障和新功能需求，请创建 <a href="https://github.com/espressif/esp-adf/issues">GitHub issue</a></li>
</ul>
<p>我们会尽快回复。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
