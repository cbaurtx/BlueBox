<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueBox: User visible changes in &lt;tt&gt;mruby3.0&lt;/tt&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueBox<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">BlueBox Bluetooth sink</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">User visible changes in <span class="tt">mruby3.0</span> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md429"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md430"></a>
Build System</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md431"></a>
<span class="tt">build_config</span> directory</h2>
<p>Typical build configuration files are located in <span class="tt">build_config</span> directory. For examples:</p>
<ul>
<li><span class="tt">default</span>: the default configuration</li>
<li><span class="tt">host-gprof</span>: compiles with <span class="tt">gprof</span> for performance tuning</li>
<li><span class="tt">host-m32</span>: compiles in gcc 32bit mode on 64bit platforms</li>
<li><span class="tt">boxing</span>: compiles all three boxing options</li>
<li><span class="tt">clang-asan</span>: compiles with <span class="tt">clang</span>'s Address Sanitizer</li>
</ul>
<p>You can specify the build configuration file with the <span class="tt">MRUBY_CONFIG</span> environment variable (or <span class="tt">CONFIG</span> in short). If the value specified by <span class="tt">MRUBY_CONFIG</span> is not the path to the configuration file, <span class="tt">build_config/${MRUBY_CONFIG}.rb</span> is used. So you can specify it as <span class="tt">rake MRUBY_CONFIG=boxing</span>, for example.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md432"></a>
Build Configuration Contribution</h1>
<p>When you write a new build configuration description, please contribute. We welcome your contribution as a GitHub pull-request.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md433"></a>
Language Changes</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md434"></a>
New Syntax</h2>
<p>We have ported some new syntax from CRuby.</p>
<ul>
<li>Single line pattern matching (<span class="tt">12 =&gt; x</span>); mruby matches only with local variables at the moment</li>
<li>Numbered block parameter (<span class="tt">x.map{_1 * 2}</span>)</li>
<li>End-less <span class="tt">def</span> (<span class="tt">def double(x) = x*2</span>)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md435"></a>
Configuration Options Changed</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md436"></a>
Renamed for consistency</h2>
<p>Some configuration macro names are changed for consistency (use <span class="tt">MRB_USE_XXX</span> or <span class="tt">MRB_NO_XXX</span>).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">mruby2  </th><th class="markdownTableHeadNone">mruby3  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">MRB_ENABLE_ALL_SYMBOLS</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_ALL_SYMBOLS</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">MRB_ENABLE_CXX_ABI</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_CXX_ABI</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">MRB_ENABLE_CXX_EXCEPTION</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_CXX_EXCEPTION</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">MRB_ENABLE_DEBUG_HOOK</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_DEBUG_HOOK</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">MRB_DISABLE_DIRECT_THREADING</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_NO_DIRECT_THREADING</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">MRB_DISABLE_STDIO</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_NO_STDIO</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">MRB_METHOD_T_STRUCT</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_METHOD_T_STRUCT</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">MRB_USE_FLOAT</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_FLOAT32</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">MRB_WITHOUT_FLOAT</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_NO_FLOAT</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">ENABLE_LINENOISE</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_LINENOISE</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">ENABLE_READLINE</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_USE_READLINE</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">DISABLE_MIRB_UNDERSCORE</span>  </td><td class="markdownTableBodyNone"><span class="tt">MRB_NO_MIRB_UNDERSCORE</span>  </td></tr>
</table>
<ul>
<li><span class="tt">MRB_USE_FLOAT32</span> is changed from <span class="tt">MRB_USE_FLOAT</span> to make sure <span class="tt">float</span> here means using single-precision float, and not the opposite of <span class="tt">MRB_NO_FLOAT</span>.</li>
<li><span class="tt">MRB_USE_METHOD_T_STRUCT</span> uses <span class="tt">struct</span> version of <span class="tt">mrb_method_t</span>. More portable but consumes more memory. Turned on by default on 32bit platforms.</li>
<li><span class="tt">MRB_</span> prefix is added to those without.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md437"></a>
<span class="tt">MRB_NO_BOXING</span></h2>
<p>Uses <span class="tt">struct</span> to represent <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span>. Consumes more memory but easier to investigate the internal and to debug. It used to be default <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span> representation. Now the default is <span class="tt">MRB_WORD_BOXING</span>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md438"></a>
<span class="tt">MRB_WORD_BOXING</span></h2>
<p>Pack <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span> in an <span class="tt">intptr_t</span> integer. Consumes less memory compared to <span class="tt">MRB_NO_BOXING</span> especially on 32-bit platforms. <span class="tt">Fixnum</span> size is 31 bits so some integer values does not fit in <span class="tt">Fixnum</span> integers.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md439"></a>
<span class="tt">MRB_NAN_BOXING</span></h2>
<p>Pack <span class="tt"><a class="el" href="structmrb__value.html">mrb_value</a></span> in a floating-point number. Nothing changed from previous versions.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md440"></a>
<span class="tt">MRB_USE_MALLOC_TRIM</span></h2>
<p>Call <span class="tt">malloc_trim(0)</span> from mrb_full_gc() if this macro is defined. If you are using glibc malloc, this macro could reduce memory consumption.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md441"></a>
Command Line Program</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md442"></a>
<span class="tt">bin/mruby</span> (by mrbgems/mruby-bin-mruby)</h2>
<p>The mruby3 now automatically detects <span class="tt">*.mrb</span> files without the <span class="tt">-b</span> switch. Therefore, it can be mixed with the <span class="tt">*.rb</span> file in combination with the <span class="tt">-r</span> switch and specified at the same time. Here's an example that works fine:</p>
<div class="fragment"><div class="line">$ bin/mruby app.mrb</div>
<div class="line">$ bin/mruby -r lib1.mrb -r lib2.rb app.rb</div>
<div class="line">$ bin/mruby -r lib1.rb -r lib2.rb &lt; app.mrb</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md443"></a>
Internal Changes</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md444"></a>
New Instructions</h2>
<p><span class="tt">mruby3</span> introduces a few new instructions.</p>
<p>Instructions that access pool[i]/syms[i] where i&gt;255.</p>
<ul>
<li><span class="tt">OP_LOADL16</span></li>
<li><span class="tt">OP_STRING16</span></li>
<li><span class="tt">OP_LOADSYM16</span></li>
</ul>
<p>Instructions that load a 32-bit integer.</p>
<ul>
<li><span class="tt">OP_LOADI32</span></li>
</ul>
<p>Instruction that unwinds jump table for rescue/ensure.</p>
<ul>
<li><span class="tt">OP_JMPUW</span></li>
</ul>
<p>Renamed from <span class="tt">OP_RAISE</span></p>
<ul>
<li><span class="tt">OP_RAISEIF</span></li>
</ul>
<p>Instruction that is reserved for the future keyword argument support.</p>
<ul>
<li>OP_SENDVK</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md445"></a>
Removed Instructions</h2>
<p>Instructions for old exception handling</p>
<ul>
<li><span class="tt">OP_ONERR</span></li>
<li><span class="tt">OP_POPERR</span></li>
<li><span class="tt">OP_EPUSH</span></li>
<li><span class="tt">OP_EPOP</span></li>
</ul>
<p>No more operand extension</p>
<ul>
<li><span class="tt">OP_EXT1</span></li>
<li><span class="tt">OP_EXT2</span></li>
<li><span class="tt">OP_EXT3</span></li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md446"></a>
Changed Instructions</h2>
<p>Jump addresses used to be specified by absolute offset from the start of <span class="tt">iseq</span>. Now they are relative offset from the address of the next instruction.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md447"></a>
<span class="tt">Random</span> now use <span class="tt">xoshiro128++</span>.</h2>
<p>For better and faster random number generation.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md448"></a>
Preallocated Symbol</h2>
<p>Preallocated symbols are interned at compile-time. They can be accessed via symbols macros (e.g. <span class="tt">MRB_SYM()</span>).</p>
<p>See <a class="el" href="md_managed__components_2espressif____nghttp_2nghttp2_2third-party_2mruby_2doc_2guides_2symbol.html">Symbols</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
