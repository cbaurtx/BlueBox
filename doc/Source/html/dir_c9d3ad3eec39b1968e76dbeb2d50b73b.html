<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueBox: managed_components/espressif__esp-dsp/applications/azure_board_apps/apps/kalman_filter Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueBox<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">BlueBox Bluetooth sink</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>managed_components</b></li><li class="navelem"><a href="dir_d664d8157ae9d72e0e60106055df655c.html">espressif__esp-dsp</a></li><li class="navelem"><a href="dir_56f5fd676f817375362b0a5a27250ea7.html">applications</a></li><li class="navelem"><a href="dir_4654bea9130514366ee0af245a63f67c.html">azure_board_apps</a></li><li class="navelem"><b>apps</b></li><li class="navelem"><a href="dir_c9d3ad3eec39b1968e76dbeb2d50b73b.html">kalman_filter</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">kalman_filter Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Directory dependency graph for kalman_filter:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="dir_c9d3ad3eec39b1968e76dbeb2d50b73b_dep.svg" width="244" height="128"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-subdirs" class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:main" id="r_main"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_4ac74c5a99774f3b9d8b862b52bf4b61.html">main</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
ESP-DSP ESP32-Azure IoT kit Kalman filter demo application</h1>
<p>The demo is developed for <a href="https://github.com/espressif/esp-bsp/tree/master/esp32_azure_iot_kit">ESP32-Azure IoT kit</a> development board and is demonstrating the usage of matrices with <span class="tt">ESP-DSP</span> <span class="tt">Mat</span> class, Kalman filter and basic 3D graphics.</p>
<p>The Kalman filter demo displays a 2D graphics, converted to 3D as a 3D object, on the development board's display. The 3D object follows the movements of the development board, where the Kalman filter is used for processing the output signals of the IMU sensors accommodated on the development board. The 3D object rotation is calculated by the Kalman filter class methods. All 3 IMU sensors present on the dev board (accelerometer, gyroscope and magnetometer) are used for sensing the development board's position.</p>
<p>If the board is inactive (no, or very low rotation is detected) for a set period of time, the demo enters an "Idle" state, in which a 3D rotating object is displayed. Once a certain set level of the board's rotation is detected, the demo enters a normal, "Active", state.</p>
<p>For the project settings, run the menuconfig using the following command: </p><pre class="fragment">idf.py mencuonfig
</pre><p>In the menuconfig's menu item <span class="tt">Demo user configuration</span> select which 3D object to display. It's either 3D cube, or ESP logo, or a user-defined graphics. Getting the user-defined 3D object is described in the <a href="../3d_graphics">3D Graphics demo</a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Kalman filter</h1>
<h3 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Calibration</h3>
<p>The filter must be calibrated before the first run, which takes several minutes. But the calibration process before each run can be omitted by calibrating the filter once, saving Kalman's filter state vectors to the NVS, and loading those vectors back into the Kalman filter before the run. In addition, every 5 minutes a current state vectors are saved into the flash memory.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Running the demo</h1>
<p>To start the demo, run the following command: </p><pre class="fragment">idf.py build flash monitor
</pre><p>The expected output is the following: </p><pre class="fragment">I (589) Kalman filter demo: Selected 3D image - 3D cube
I (590) Kalman filter demo: Filter state vectors present in the NVS
I (592) Kalman filter demo: Loading state vectors into the filter structure
I (604) Kalman filter demo: State vectors loaded from the NVS
I (606) Barometer: disabled
I (619) Board status: board put to active mode
I (95780) Board status: board put to idle mode
I (300619) Kalman filter demo: State vectors saved to NVS
</pre><p>Note, that the first line <span class="tt">Selected 3D image</span> from the expected output depends on the user's Kconfing menu selection</p>
<p>To start the demo and run the initial Kalman filter calibration, one must erase the flash memory, to remove the previously stored Kalman filter's state vectors. To do so, run the following command: </p><pre class="fragment">idf.py erase_flash build flash monitor
</pre><p>The expected output is the following: </p><pre class="fragment">I (592) Kalman filter demo: Selected 3D image - 3D cube
I (595) Kalman filter demo: Filter state vectors not present in the NVS
I (595) Kalman filter demo: Starting Kalman filter calibration loop
I (100699) Kalman filter demo: Exiting Kalman filter calibration loop
I (100894) Kalman filter demo: Estimated gyroscope bias error [deg/sec]: -0.020715  -0.000431   -0.022452
I (100900) Kalman filter demo: State vectors saved to the NVS
I (100900) Barometer: disabled
I (100911) Board status: board put to active mode
I (196072) Board status: board put to idle mode
I (400912) Kalman filter demo: State vectors saved to NVS
</pre><div align="center"> <img src="applications/azure_board_apps/apps/kalman_filter/kalman_filter.gif" alt="" class="inline"/> </div> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
